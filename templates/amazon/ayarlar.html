{% extends "base.html" %}

{% block title %}Amazon AyarlarÄ±{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2>
                <i class="fab fa-amazon"></i> Amazon AyarlarÄ±
            </h2>
        </div>
    </div>

    <!-- Durum KartÄ± -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card {% if config.is_configured %}border-success{% else %}border-danger{% endif %}">
                <div class="card-header {% if config.is_configured %}bg-success{% else %}bg-danger{% endif %} text-white">
                    <h5 class="mb-0">
                        {% if config.is_configured %}
                        <i class="fas fa-check-circle"></i> API BaÄŸlantÄ±sÄ± Aktif
                        {% else %}
                        <i class="fas fa-times-circle"></i> API YapÄ±landÄ±rÄ±lmamÄ±ÅŸ
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>Marketplace ID:</strong></td>
                            <td>{{ config.marketplace_id or 'AyarlanmamÄ±ÅŸ' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Seller ID:</strong></td>
                            <td>{{ config.seller_id }}</td>
                        </tr>
                        <tr>
                            <td><strong>AWS Region:</strong></td>
                            <td>{{ config.region or 'AyarlanmamÄ±ÅŸ' }}</td>
                        </tr>
                    </table>
                    
                    <button class="btn btn-primary" onclick="testConnection()">
                        <i class="fas fa-plug"></i> BaÄŸlantÄ± Testi
                    </button>
                    
                    <div id="testResult" class="mt-3"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Marketplace ID'leri</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Ãœlke</th>
                                <th>Marketplace ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-warning"><td>ðŸ‡¹ðŸ‡· TÃ¼rkiye</td><td><code>A33AVAJ2PDY3EV</code></td></tr>
                            <tr><td>ðŸ‡©ðŸ‡ª Almanya</td><td><code>A1PA6795UKMFR9</code></td></tr>
                            <tr><td>ðŸ‡¬ðŸ‡§ Ä°ngiltere</td><td><code>A1F83G8C2ARO7P</code></td></tr>
                            <tr><td>ðŸ‡«ðŸ‡· Fransa</td><td><code>A13V1IB3VIYBER</code></td></tr>
                            <tr><td>ðŸ‡®ðŸ‡¹ Ä°talya</td><td><code>APJ6JRA9NG5V4</code></td></tr>
                            <tr><td>ðŸ‡ªðŸ‡¸ Ä°spanya</td><td><code>A1RKKUPIHCS9HS</code></td></tr>
                            <tr><td>ðŸ‡³ðŸ‡± Hollanda</td><td><code>A1805IZSGTT6HS</code></td></tr>
                            <tr><td>ðŸ‡µðŸ‡± Polonya</td><td><code>A1C3SOZRARQ6R3</code></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- YapÄ±landÄ±rma Rehberi -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-book"></i> YapÄ±landÄ±rma Rehberi</h5>
                </div>
                <div class="card-body">
                    <h6>1. .env dosyasÄ±na eklenecek deÄŸiÅŸkenler:</h6>
                    <pre class="bg-dark text-light p-3 rounded"><code># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AMAZON SP-API AYARLARI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# LWA (Login with Amazon) Credentials
# https://developer.amazon.com/apps-and-games/login-with-amazon
AMAZON_LWA_CLIENT_ID=amzn1.application-oa2-client.xxxxxxxxxxxx
AMAZON_LWA_CLIENT_SECRET=your_lwa_client_secret_here

# Refresh Token (SP-API uygulamasÄ± yetkilendirildikten sonra alÄ±nÄ±r)
AMAZON_REFRESH_TOKEN=Atzr|xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Seller ID (Seller Central > Settings > Account Info)
AMAZON_SELLER_ID=AXXXXXXXXXXXX

# Marketplace ID (TÃ¼rkiye iÃ§in A33AVAJ2PDY3EV)
AMAZON_MARKETPLACE_ID=A33AVAJ2PDY3EV

# AWS IAM Credentials
AMAZON_AWS_ACCESS_KEY=AKIAXXXXXXXXXXXX
AMAZON_AWS_SECRET_KEY=your_aws_secret_key_here
AMAZON_AWS_REGION=eu-west-1

# Opsiyonel: Role ARN (STS assume role iÃ§in)
# AMAZON_ROLE_ARN=arn:aws:iam::xxxxxxxxxxxx:role/SellerPartnerAPIRole</code></pre>

                    <hr>
                    
                    <h6>2. Gerekli Python Paketini YÃ¼kleyin:</h6>
                    <pre class="bg-dark text-light p-3 rounded"><code>pip install python-amazon-sp-api</code></pre>
                    
                    <hr>
                    
                    <h6>3. AdÄ±m AdÄ±m Kurulum:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">1</span> Developer KaydÄ±</h6>
                                    <p class="mb-0 small">Amazon Seller Central > Settings > User Permissions > "Register yourself as a developer"</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">2</span> AWS IAM KullanÄ±cÄ±sÄ±</h6>
                                    <p class="mb-0 small">AWS Console > IAM > Users > Add user (Programmatic access)</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">3</span> LWA Credentials</h6>
                                    <p class="mb-0 small">developer.amazon.com > Login with Amazon > Security Profile oluÅŸtur</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">4</span> SP-API UygulamasÄ±</h6>
                                    <p class="mb-0 small">Seller Central > Apps & Services > Develop Apps > Add new app client</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">5</span> UygulamayÄ± Yetkilendir</h6>
                                    <p class="mb-0 small">Manage Your Apps > Authorize > Refresh Token alÄ±n</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6><span class="badge badge-primary">6</span> .env GÃ¼ncelleyin</h6>
                                    <p class="mb-0 small">TÃ¼m bilgileri .env dosyasÄ±na ekleyin ve uygulamayÄ± yeniden baÅŸlatÄ±n</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function testConnection() {
    document.getElementById('testResult').innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> Test ediliyor...</div>';
    
    fetch('{{ url_for("amazon.test_connection") }}')
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                document.getElementById('testResult').innerHTML = '<div class="alert alert-success"><i class="fas fa-check"></i> ' + data.message + '</div>';
            } else {
                document.getElementById('testResult').innerHTML = '<div class="alert alert-danger"><i class="fas fa-times"></i> ' + data.message + '</div>';
            }
        });
}
</script>
{% endblock %}
