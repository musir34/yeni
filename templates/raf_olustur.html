<!doctype html>
<html lang="tr">
    <head>
        <meta charset="UTF-8" />
        <title>Raf Y√∂netimi ‚Äì G√ºll√º Ayakkabƒ±</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
        />

        <style>
            :root {
                --color-primary: #b76e79;
                --color-primary-dark: #a05f6a;
                --color-secondary: #212529;
                --color-text: #343a40;
                --color-bg: #f8f9fa;
                --color-bg-light: #ffffff;
                --color-white: #fff;
                --color-border: #dee2e6;
                --font-family-base: "Inter", sans-serif;
                --border-radius: 0.5rem;
                --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.08);
                --transition: all 0.25s ease-in-out;
            }
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: var(--font-family-base);
                background-color: var(--color-bg);
                color: var(--color-text);
                padding: 2rem;
            }
            .container {
                max-width: 1200px;
                margin: auto;
            }
            h1 {
                text-align: center;
                color: var(--color-secondary);
                margin-bottom: 2rem;
                font-weight: 700;
            }
            .header-actions {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 2rem;
                flex-wrap: wrap;
            }
            .btn {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.6rem 1.2rem;
                font-weight: 600;
                font-size: 0.9rem;
                border: none;
                border-radius: var(--border-radius);
                text-decoration: none;
                cursor: pointer;
                transition: var(--transition);
            }
            .btn-sm {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            .btn-primary {
                background: linear-gradient(
                    45deg,
                    var(--color-primary),
                    var(--color-primary-dark)
                );
                color: white;
            }
            .btn-secondary {
                background-color: var(--color-secondary);
                color: white;
            }
            .btn-danger {
                background-color: #dc3545;
                color: white;
            }
            .btn:hover {
                opacity: 0.9;
                transform: translateY(-1px);
            }
            .main-card {
                background-color: var(--color-white);
                padding: 2rem;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow-md);
                margin-bottom: 2rem;
            }
            input[type="text"],
            input[type="number"] {
                width: 100%;
                padding: 0.7rem 1rem;
                border: 1px solid var(--color-border);
                border-radius: var(--border-radius);
                font-size: 1rem;
            }
            .form-inline {
                display: flex;
                gap: 1rem;
                align-items: center;
            }
            .form-inline input {
                margin-bottom: 0;
            }
            .form-inline > div {
                flex-grow: 1;
            }
            .text-muted {
                color: #6c757d;
            }
            .mt-3 {
                margin-top: 1rem;
            }
            .mb-4 {
                margin-bottom: 1.5rem;
            }
            .text-center {
                text-align: center;
            }
            .collapsible-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                background-color: var(--color-bg);
                border: 1px solid var(--color-border);
                border-radius: var(--border-radius);
                cursor: pointer;
                transition: var(--transition);
            }
            .collapsible-header:hover {
                background-color: #e9ecef;
            }
            .collapsible-header h3,
            .collapsible-header h4 {
                margin: 0;
                font-weight: 600;
            }
            .collapsible-content {
                display: none;
                padding: 1rem;
                padding-left: 2.5rem;
                border: 1px solid var(--color-border);
                border-top: none;
                border-bottom-left-radius: var(--border-radius);
                border-bottom-right-radius: var(--border-radius);
            }
            .ana-raf-grup,
            .ikincil-raf-grup {
                margin-bottom: 1rem;
            }
            .kat-item {
                padding: 1rem;
                border: 1px solid var(--color-border);
                border-radius: var(--border-radius);
                margin-bottom: 1rem;
                background-color: #fff;
            }
            .kat-item-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .kat-item-header h5 {
                font-weight: 600;
                color: var(--color-primary-dark);
                margin: 0;
            }
            .raf-checkbox {
                display: none;
            }
            .stok-listesi-container {
                display: none;
                background-color: #fff;
                padding: 1rem;
                margin-top: 1rem;
                border-top: 2px solid var(--color-bg);
            }
            .stok-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 1rem;
            }
            .stok-table th,
            .stok-table td {
                border: 1px solid var(--color-border);
                padding: 0.75rem;
                text-align: left;
                vertical-align: middle;
                font-size: 0.9rem;
            }
            .stok-table thead {
                background-color: var(--color-bg);
            }
            .stok-table th {
                font-weight: 600;
            }
            .stok-table input[type="number"] {
                width: 70px;
                padding: 0.4rem;
                margin-bottom: 0;
                display: inline-block;
            }
            .stok-table .actions-form {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .info-btn{
              width: 32px; height: 32px; border-radius: 50%;
              border: 0; cursor: pointer; font-weight: 800;
              background: linear-gradient(45deg, var(--color-primary), var(--color-primary-dark));
              color: #fff; display:flex; align-items:center; justify-content:center;
              box-shadow: var(--shadow-md); transition: var(--transition);
            }.info-btn:hover{ transform: translateY(-1px); opacity: .95; }.modal-backdrop{
              position: fixed; inset: 0; background: rgba(0,0,0,.45);
              display:none; z-index: 9998;
            }.modal-wrap{
              position: fixed; inset: 0; display:none;
              align-items: center; justify-content: center; z-index: 9999;
            }.modal{
              width: min(920px, 92vw); max-height: 88vh; overflow: auto;
              background: #fff; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,.25);
              padding: 1rem 1rem 1.25rem;
            }.modal-header{
              display:flex; align-items:center; justify-content: space-between; gap:.75rem;
              padding: .5rem 0 .75rem; border-bottom:1px solid var(--color-border);
            }.modal-header h3{ margin:0; font-weight: 700; color: var(--color-secondary); }.modal-close{
              border:0; background:transparent; cursor:pointer; font-size: 20px; line-height: 1;
              color:#666; padding:.25rem .5rem; border-radius:8px;
            }.modal-close:hover{ background:#f0f0f0; }.tab-bar{
              display:flex; gap:.5rem; padding:.75rem 0; border-bottom:1px solid var(--color-border);
            }.tab-btn{
              border:1px solid var(--color-border); background:#fff; color:#333;
              padding:.45rem .8rem; border-radius:8px; cursor:pointer; font-weight:600; font-size:.9rem;
            }.tab-btn.active{
              background:linear-gradient(45deg, var(--color-primary), var(--color-primary-dark));
              color:#fff; border-color: transparent;
            }.tab-panel{ display:none; padding: 1rem 0 .5rem; line-height:1.6; }.tab-panel.active{ display:block; }.badge{
              display:inline-block; padding:.15rem .5rem; font-size:.75rem;
              border-radius:999px; background:#eef2f6; color:#334155; border:1px solid #e2e8f0;
            }.code{
              background:#0f172a; color:#e2e8f0; border-radius:8px; padding:.5rem .75rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.85rem; overflow:auto;
            }ul.clean{ margin: .25rem 0 .25rem 1.1rem; }ul.clean li{ margin:.15rem 0; }
            
            /* G√úZEL UYARI MODALƒ± */
            .custom-modal-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                z-index: 10000;
                backdrop-filter: blur(4px);
            }
            .custom-modal-wrap {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 10001;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            }
            .custom-modal-wrap.active {
                display: flex !important;
            }
            .custom-modal-box {
                background: white;
                border-radius: 16px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 500px;
                width: 100%;
                padding: 2rem;
                animation: modalSlideIn 0.3s ease-out;
                position: relative;
            }
            @keyframes modalSlideIn {
                from {
                    transform: translateY(-20px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            .custom-modal-icon {
                width: 64px;
                height: 64px;
                margin: 0 auto 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                font-size: 32px;
            }
            .custom-modal-icon.warning {
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                color: white;
            }
            .custom-modal-icon.success {
                background: linear-gradient(135deg, #51cf66, #37b24d);
                color: white;
            }
            .custom-modal-title {
                font-size: 1.5rem;
                font-weight: 700;
                text-align: center;
                margin-bottom: 1rem;
                color: var(--color-secondary);
            }
            .custom-modal-message {
                font-size: 1rem;
                line-height: 1.6;
                text-align: center;
                color: #666;
                margin-bottom: 2rem;
                white-space: pre-line;
            }
            .custom-modal-buttons {
                display: flex;
                gap: 1rem;
                justify-content: center;
            }
            .custom-modal-btn {
                padding: 0.75rem 2rem;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                min-width: 120px;
            }
            .custom-modal-btn.confirm {
                background: linear-gradient(45deg, #dc3545, #c82333);
                color: white;
            }
            .custom-modal-btn.confirm:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
            }
            .custom-modal-btn.cancel {
                background: #e9ecef;
                color: #495057;
            }
            .custom-modal-btn.cancel:hover {
                background: #dee2e6;
            }
            .custom-modal-btn.ok {
                background: linear-gradient(45deg, var(--color-primary), var(--color-primary-dark));
                color: white;
            }
            .custom-modal-btn.ok:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(183, 110, 121, 0.4);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1 style="display:flex;align-items:center;justify-content:center;gap:0.6rem;">
              üì¶ Raf Y√∂netimi
              <button type="button" class="info-btn" title="Raf Sistemi Bilgi" onclick="openInfoModal()">
                !
              </button>
            </h1>
            <div class="header-actions">
                <a href="{{ url_for('home.home') }}" class="btn btn-secondary"
                    ><i class="bi bi-house-door"></i> Ana Sayfa</a
                >
                <a href="{{ url_for('raf.stok_form') }}" class="btn btn-primary"
                    ><i class="bi bi-plus-circle"></i> Stok Ekle</a
                >
                <button class="btn btn-primary" onclick="tumRaflariYazdir()">
                    <i class="bi bi-printer-fill"></i> T√ºm Raflarƒ± Yazdƒ±r
                </button>
                <button id="secimModuBtn" class="btn btn-secondary" onclick="secimModuToggle()" style="background: linear-gradient(45deg, #6c757d, #5a6268);">
                    <i class="bi bi-ui-checks"></i> Se√ßmeyi Etkinle≈ütir
                </button>
                <button id="seciliYazdirBtn" class="btn btn-primary" onclick="seciliRaflariYazdir()" style="background: linear-gradient(45deg, #28a745, #20873a); display: none;">
                    <i class="bi bi-check2-square"></i> Se√ßili Raflarƒ± Yazdƒ±r
                </button>
                <button id="seciliSilBtn" class="btn btn-danger" onclick="seciliRaflariSil()" style="display: none;">
                    <i class="bi bi-trash-fill"></i> Se√ßili Raflarƒ± Sil
                </button>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div style="margin-bottom:1rem;">
                  {% for category, message in messages %}
                    <div class="alert alert-{{ category }}" role="alert"
                         style="padding:10px;border-radius:8px;margin-bottom:8px;
                                {% if category=='success' %}background:#e6ffed;border:1px solid #b7f5c5;color:#1b5e20{% endif %}
                                {% if category=='warning' %}background:#fff8e1;border:1px solid #ffe69c;color:#8a6d3b{% endif %}
                                {% if category=='danger' %}background:#ffebee;border:1px solid #ffcdd2;color:#b71c1c{% endif %}">
                      {{ message }}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            <div class="main-card">
                <h4 class="mb-4">Yeni Raf Olu≈ütur</h4>
                <form id="rafForm" class="form-inline">
                    <input
                        type="text"
                        name="ana"
                        placeholder="Ana Kod (√ñrn: A)"
                        required
                    />
                    <input
                        type="text"
                        name="ikincil"
                        placeholder="ƒ∞kincil Kod (√ñrn: 01)"
                        required
                    />
                    <input
                        type="number"
                        name="kat"
                        placeholder="Kat (√ñrn: 1)"
                        required
                    />
                    <button
                        type="submit"
                        class="btn btn-primary"
                        style="padding-top: 0.7rem; padding-bottom: 0.7rem"
                    >
                        <i class="bi bi-plus-circle"></i> Olu≈ütur
                    </button>
                </form>
                <div id="rafSonuc" class="mt-3"></div>
            </div>

            <div class="main-card">
                <h4>üîç Barkod ile √úr√ºn Ara</h4>
                <form onsubmit="barkodAra(event)">
                    <input
                        type="text"
                        id="barkodInput"
                        placeholder="Barkod giriniz..."
                        style="width: 100%; padding: 0.6rem"
                        required
                    />
                    <button
                        type="submit"
                        class="btn btn-primary"
                        style="margin-top: 0.8rem"
                    >
                        <i class="bi bi-search"></i> Ara
                    </button>
                </form>
                <div id="barkodSonuc" style="margin-top: 1rem"></div>
            </div>

            <div class="main-card">
                <h4 class="mb-4">üóÇ Mevcut Raflar</h4>
                <div class="mb-3">
                    <input
                        type="text"
                        id="rafAramaInput"
                        class="form-control"
                        placeholder="üîç Ana raf, ikincil raf veya kat ara..."
                    />
                </div>
                <div id="rafListesiYeri"></div>
                <p
                    id="rafYokMesaji"
                    class="text-muted text-center mt-3"
                    style="display: none"
                >
                    Kayƒ±tlƒ± raf bulunamadƒ±.
                </p>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                async function raflariGetir() {
                    const container = document.getElementById("rafListesiYeri");
                    container.innerHTML =
                        '<p class="text-muted text-center">Y√ºkleniyor...</p>';
                    try {
                        const res = await fetch("/raf/api/kademeli-liste");
                        const data = await res.json();
                        container.innerHTML = "";
                        const anaRaflar = Object.keys(data).sort();
                        if (anaRaflar.length === 0) {
                            document.getElementById(
                                "rafYokMesaji",
                            ).style.display = "block";
                            return;
                        }
                        document.getElementById("rafYokMesaji").style.display =
                            "none";
                        anaRaflar.forEach((anaKod) => {
                            const anaGrupDiv = document.createElement("div");
                            anaGrupDiv.className = "ana-raf-grup";
                            anaGrupDiv.setAttribute(
                                "data-search-text",
                                anaKod.toLowerCase(),
                            );
                            const anaHeader = document.createElement("div");
                            anaHeader.className = "collapsible-header";
                            anaHeader.innerHTML = `
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="raf-checkbox ana-raf-cb" value="${anaKod}" style="width: 18px; height: 18px; cursor: pointer; display: none;">
                                    <h3 style="margin: 0;"><i class="bi bi-folder"></i> Ana Raf: ${anaKod}</h3>
                                </div>
                                <i class="bi bi-chevron-down collapse-icon"></i>
                            `;
                            const anaContent = document.createElement("div");
                            anaContent.className = "collapsible-content";
                            const ikincilRaflar = Object.keys(
                                data[anaKod],
                            ).sort();
                            ikincilRaflar.forEach((ikincilKod) => {
                                const ikincilGrupDiv =
                                    document.createElement("div");
                                ikincilGrupDiv.className = "ikincil-raf-grup";
                                ikincilGrupDiv.setAttribute(
                                    "data-search-text",
                                    `${anaKod.toLowerCase()} ${ikincilKod.toLowerCase()}`,
                                );
                                const ikincilHeader =
                                    document.createElement("div");
                                ikincilHeader.className = "collapsible-header";
                                ikincilHeader.innerHTML = `
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" class="raf-checkbox ikincil-raf-cb" value="${ikincilKod}" style="width: 18px; height: 18px; cursor: pointer; display: none;">
                                        <h4 style="margin: 0;"><i class="bi bi-collection"></i> ${ikincilKod}</h4>
                                    </div>
                                    <i class="bi bi-chevron-down collapse-icon"></i>
                                `;
                                const ikincilContent =
                                    document.createElement("div");
                                ikincilContent.className =
                                    "collapsible-content";
                                const katlar = data[anaKod][ikincilKod].sort(
                                    (a, b) =>
                                        a.kat.localeCompare(b.kat, undefined, {
                                            numeric: true,
                                        }),
                                );
                                katlar.forEach((katObj) => {
                                    const tamRafKodu = `${ikincilKod}-${katObj.kat}`;
                                    const katDiv = document.createElement("div");
                                    katDiv.className = "kat-item";
                                    katDiv.setAttribute(
                                        "data-search-text",
                                        `${anaKod.toLowerCase()} ${ikincilKod.toLowerCase()} ${katObj.kat.toLowerCase()}`,
                                    );

                                    // Yazdƒ±r butonu artƒ±k en ba≈üƒ±ndan itibaren aktif ve basit
                                    katDiv.innerHTML = `
                                <div class="kat-item-header">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" class="raf-checkbox kat-raf-cb" value="${tamRafKodu}" style="width: 18px; height: 18px; cursor: pointer; display: none;">
                                        <h5 style="margin: 0;"><i class="bi bi-layers-fill"></i> Kat: ${katObj.kat} (Kod: ${tamRafKodu})</h5>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-secondary btn-sm" onclick="yazdirRafEtiketi('${tamRafKodu}')">
                                            <i class="bi bi-printer"></i> Yazdƒ±r
                                        </button>
                                        <button class="btn btn-primary btn-sm" onclick="stoklariGoster('${tamRafKodu}', this)">
                                            <i class="bi bi-box-seam"></i> Stoklarƒ± G√∂ster
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="rafiSil('${tamRafKodu}')">
                                            <i class="bi bi-trash"></i> Sil
                                        </button>
                                    </div>
                                </div>
                                <div class="stok-listesi-container" id="stok-listesi-${tamRafKodu}"></div>
                            `;

                                    ikincilContent.appendChild(katDiv);
                                });
                                ikincilGrupDiv.appendChild(ikincilHeader);
                                ikincilGrupDiv.appendChild(ikincilContent);
                                anaContent.appendChild(ikincilGrupDiv);
                                ikincilHeader.addEventListener("click", () =>
                                    toggleCollapse(
                                        ikincilContent,
                                        ikincilHeader.querySelector(
                                            ".collapse-icon",
                                        ),
                                    ),
                                );
                            });
                            anaGrupDiv.appendChild(anaHeader);
                            anaGrupDiv.appendChild(anaContent);
                            container.appendChild(anaGrupDiv);
                            anaHeader.addEventListener("click", () =>
                                toggleCollapse(
                                    anaContent,
                                    anaHeader.querySelector(".collapse-icon"),
                                ),
                            );
                        });
                    } catch (err) {
                        console.error("Raflar √ßekilemedi:", err);
                        container.innerHTML =
                            '<p style="color:red" class="text-center">Raflar y√ºklenirken bir hata olu≈ütu.</p>';
                    }
                }

                document
                    .getElementById("rafAramaInput")
                    .addEventListener("input", function () {
                        const arama = this.value.toLowerCase().trim();
                        document
                            .querySelectorAll(".kat-item")
                            .forEach((item) => {
                                item.style.display = item
                                    .getAttribute("data-search-text")
                                    .includes(arama)
                                    ? "block"
                                    : "none";
                            });
                        document
                            .querySelectorAll(".ikincil-raf-grup")
                            .forEach((grup) => {
                                const gorunurKatVar = grup.querySelector(
                                    '.kat-item[style*="display: block"]',
                                );
                                grup.style.display =
                                    grup
                                        .getAttribute("data-search-text")
                                        .includes(arama) || gorunurKatVar
                                        ? "block"
                                        : "none";
                            });
                        document
                            .querySelectorAll(".ana-raf-grup")
                            .forEach((grup) => {
                                const gorunurIkincilVar = grup.querySelector(
                                    '.ikincil-raf-grup[style*="display: block"]',
                                );
                                grup.style.display =
                                    grup
                                        .getAttribute("data-search-text")
                                        .includes(arama) || gorunurIkincilVar
                                        ? "block"
                                        : "none";
                            });
                    });

                document
                    .getElementById("rafForm")
                    .addEventListener("submit", async function (e) {
                        e.preventDefault();
                        const formData = new FormData(this);
                        const data = {
                            ana: formData.get("ana"),
                            ikincil: formData.get("ikincil"),
                            kat: formData.get("kat"),
                        };
                        const res = await fetch("/raf/olustur", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data),
                        });
                        const result = await res.json();
                        const sonucDiv = document.getElementById("rafSonuc");
                        if (res.status === 201) {
                            sonucDiv.innerHTML = `<p style="color:green;">‚úÖ ${result.message} ‚Äì ${result.kod}</p>`;
                            document.getElementById("rafForm").reset();
                            raflariGetir();
                        } else {
                            sonucDiv.innerHTML = `<p style="color:red;">‚ùå ${result.error || "Bir hata olu≈ütu."}</p>`;
                        }
                        setTimeout(() => {
                            sonucDiv.innerHTML = "";
                        }, 3000);
                    });

                raflariGetir();
            });

            function toggleCollapse(contentElement, iconElement) {
                const isVisible = contentElement.style.display === "block";
                contentElement.style.display = isVisible ? "none" : "block";
                if (iconElement) {
                    iconElement.classList.toggle("bi-chevron-down", isVisible);
                    iconElement.classList.toggle("bi-chevron-up", !isVisible);
                }
            }

            async function stoklariGoster(rafKodu, button) {
                const container = document.getElementById(
                    `stok-listesi-${rafKodu}`,
                );
                const isVisible = container.style.display === "block";
                document
                    .querySelectorAll(".stok-listesi-container")
                    .forEach((c) => {
                        if (c.id !== container.id) c.style.display = "none";
                    });
                document
                    .querySelectorAll(".kat-item-header .btn-primary")
                    .forEach((b) => {
                        if (b !== button)
                            b.innerHTML =
                                '<i class="bi bi-box-seam"></i> Stoklarƒ± G√∂ster';
                    });
                if (isVisible) {
                    container.style.display = "none";
                    button.innerHTML =
                        '<i class="bi bi-box-seam"></i> Stoklarƒ± G√∂ster';
                } else {
                    button.innerHTML =
                        '<i class="bi bi-arrow-clockwise"></i> Y√ºkleniyor...';
                    button.disabled = true;
                    try {
                        const res = await fetch(`/raf/api/stoklar/${rafKodu}`);
                        const stoklar = await res.json();
                        let content = `
                        <input type="text" placeholder="Bu raftaki √ºr√ºnleri filtrele..." onkeyup="stokAra(this, '${rafKodu}')" style="margin-bottom: 1rem; padding: 0.5rem; font-size: 0.9rem; width:100%;">
                        <div style="overflow-x:auto;">
                            <table class="stok-table" id="table-${rafKodu}">
                                <thead><tr><th>Model</th><th>Renk</th><th>Beden</th><th>Adet</th><th>ƒ∞≈ülem</th></tr></thead>
                                <tbody>`;
                        if (stoklar.length > 0) {
                            stoklar.forEach((urun) => {
                                content += `
                            <tr data-search="${(urun.model + " " + urun.color + " " + urun.barkod).toLowerCase()}">
                                <td>${urun.model}</td><td>${urun.color}</td><td>${urun.size}</td><td>${urun.adet}</td>
                                <td>
                                    <div class="actions-form">
                                        <form method="post" action="/raf/stok-guncelle" style="display:inline-flex; gap: 0.5rem; align-items: center;">
                                            <input type="hidden" name="raf_kodu" value="${rafKodu}"><input type="hidden" name="barkod" value="${urun.barkod}">
                                            <input type="number" name="adet" value="${urun.adet}" min="0">
                                            <button type="submit" class="btn btn-primary btn-sm">G√ºncelle</button>
                                        </form>
                                        <form method="post" action="/raf/stok-sil" style="display:inline-block;">
                                            <input type="hidden" name="raf_kodu" value="${rafKodu}"><input type="hidden" name="barkod" value="${urun.barkod}">
                                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Bu √ºr√ºn√º raftan silmek istediƒüine emin misin?')"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </div>
                                </td>
                            </tr>`;
                            });
                        } else {
                            content +=
                                '<tr><td colspan="5" class="text-center text-muted">Bu rafta hi√ß √ºr√ºn bulunmuyor.</td></tr>';
                        }
                        content += "</tbody></table></div>";
                        container.innerHTML = content;
                        container.style.display = "block";
                        button.innerHTML =
                            '<i class="bi bi-eye-slash"></i> Stoklarƒ± Gizle';
                    } catch (err) {
                        console.error("Stoklar √ßekilemedi:", err);
                        container.innerHTML = `<p style="color:red">Stoklar y√ºklenemedi.</p>`;
                    } finally {
                        button.disabled = false;
                    }
                }
            }

            function stokAra(input, rafKodu) {
                const filter = input.value.toLowerCase();
                const table = document.getElementById(`table-${rafKodu}`);
                const rows = table.getElementsByTagName("tr");
                for (let i = 1; i < rows.length; i++) {
                    const searchData = rows[i].getAttribute("data-search");
                    if (searchData) {
                        rows[i].style.display = searchData.includes(filter)
                            ? ""
                            : "none";
                    }
                }
            }

            async function rafiSil(rafKodu) {
                if (
                    !confirm(
                        `'${rafKodu}' kodlu rafƒ± ve i√ßindeki T√úM √ºr√ºnleri kalƒ±cƒ± olarak silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!`,
                    )
                ) {
                    return;
                }
                try {
                    const res = await fetch(`/raf/sil/${rafKodu}`, {
                        method: "POST",
                    });
                    const result = await res.json();
                    const sonucDiv = document.getElementById("rafSonuc");
                    if (res.ok) {
                        sonucDiv.innerHTML = `<p style="color:green;">‚úÖ ${result.message}</p>`;
                        raflariGetir();
                    } else {
                        sonucDiv.innerHTML = `<p style="color:red;">‚ùå Hata: ${result.error || "Raf silinirken bir sorun olu≈ütu."}</p>`;
                    }
                    setTimeout(() => {
                        sonucDiv.innerHTML = "";
                    }, 4000);
                } catch (error) {
                    console.error("Raf silme hatasƒ±:", error);
                    document.getElementById("rafSonuc").innerHTML =
                        `<p style="color:red;">‚ùå Bir aƒü hatasƒ± olu≈ütu.</p>`;
                }
            }

            // YAZDIRMA FONKSƒ∞YONU (BACKEND DESTEKLƒ∞, BASƒ∞T VE G√úVENƒ∞Lƒ∞R Y√ñNTEM)
            function yazdirRafEtiketi(rafKodu) {
                const printWindow = window.open("", "_blank");
                printWindow.document.write(`
        <html>
            <head>
                <title>Raf Etiketi Yazdƒ±r - ${rafKodu}</title>
                <style>
                    @page { size: 100mm 100mm; margin: 0; }
                    body { 
                        width: 100mm;
                        height: 100mm;
                        margin: 0;
                        padding: 0;
                        font-family: Arial, sans-serif;
                        display: flex;
                        flex-direction: column; 
                        align-items: center;    
                        justify-content: center;
                        box-sizing: border-box; 
                        padding: 5mm;
                        gap: 4mm;
                    }
                    .raf-kodu {
                        font-size: 28pt;
                        font-weight: bold;
                        margin: 0;
                        text-align: center;
                        flex-shrink: 0;
                    }
                    .gorsel-alani {
                        width: 100%;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        gap: 2mm;
                    }
                    img {
                        max-width: 85mm; /* Ta≈ümalarƒ± engellemek i√ßin */
                    }
                    #qr-image {
                        max-width: 45mm;
                        max-height: 45mm;
                    }
                    #barcode-image {
                        max-width: 80mm;
                        max-height: 18mm;
                    }
                </style>
            </head>
            <body>
                <div class="raf-kodu">${rafKodu}</div>
                <div class="gorsel-alani">
                    <img id="qr-image" src="/raf/etiket/qr/${rafKodu}">
                    <img id="barcode-image" src="/raf/etiket/barkod/${rafKodu}">
                </div>
                <script>
                    window.onload = function() {
                        // Backend'den resimlerin y√ºklenmesini beklemek i√ßin k√º√ß√ºk bir gecikme
                        setTimeout(function() {
                            window.print();
                        }, 250); // Gecikmeyi biraz artƒ±rarak garantiye alalƒ±m

                        window.onafterprint = function() {
                           window.close();
                        }
                    }
                <\/script>
            </body>
        </html>
    `);
                printWindow.document.close();
            }

            // SE√áƒ∞M MODU TOGGLE
            let secimModuAktif = false;
            
            function secimModuToggle() {
                secimModuAktif = !secimModuAktif;
                const checkboxlar = document.querySelectorAll('.raf-checkbox');
                const secimBtn = document.getElementById('secimModuBtn');
                const yazdirBtn = document.getElementById('seciliYazdirBtn');
                const silBtn = document.getElementById('seciliSilBtn');
                
                if (secimModuAktif) {
                    checkboxlar.forEach(cb => cb.style.display = 'inline-block');
                    secimBtn.innerHTML = '<i class="bi bi-x-circle"></i> Se√ßimi Kapat';
                    secimBtn.style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
                    yazdirBtn.style.display = 'inline-flex';
                    silBtn.style.display = 'inline-flex';
                } else {
                    checkboxlar.forEach(cb => {
                        cb.style.display = 'none';
                        cb.checked = false;
                    });
                    secimBtn.innerHTML = '<i class="bi bi-ui-checks"></i> Se√ßmeyi Etkinle≈ütir';
                    secimBtn.style.background = 'linear-gradient(45deg, #6c757d, #5a6268)';
                    yazdirBtn.style.display = 'none';
                    silBtn.style.display = 'none';
                }
            }

            // SE√áƒ∞Lƒ∞ RAFLARI Sƒ∞L
            async function seciliRaflariSil() {
                const katRafCheckboxes = document.querySelectorAll('.kat-raf-cb:checked');
                const anaRafCheckboxes = document.querySelectorAll('.ana-raf-cb:checked');
                const ikincilRafCheckboxes = document.querySelectorAll('.ikincil-raf-cb:checked');
                
                if (katRafCheckboxes.length === 0 && anaRafCheckboxes.length === 0 && ikincilRafCheckboxes.length === 0) {
                    await showCustomModal({
                        type: 'warning',
                        title: 'Se√ßim Yok',
                        message: 'L√ºtfen silmek istediƒüiniz raflarƒ± se√ßin!',
                        buttons: 'ok'
                    });
                    return;
                }
                
                const seciliRafKodlari = [
                    ...Array.from(katRafCheckboxes).map(cb => cb.value),
                    ...Array.from(anaRafCheckboxes).map(cb => cb.value),
                    ...Array.from(ikincilRafCheckboxes).map(cb => cb.value)
                ];
                
                const anaRafSayisi = anaRafCheckboxes.length;
                const ikincilRafSayisi = ikincilRafCheckboxes.length;
                const tekRafSayisi = katRafCheckboxes.length;
                let mesaj = '';
                
                if (anaRafSayisi > 0) {
                    mesaj += `‚Ä¢ ${anaRafSayisi} ana raf (t√ºm alt raflarƒ±yla birlikte)\n`;
                }
                if (ikincilRafSayisi > 0) {
                    mesaj += `‚Ä¢ ${ikincilRafSayisi} ikincil raf (t√ºm katlarƒ±yla birlikte)\n`;
                }
                if (tekRafSayisi > 0) {
                    mesaj += `‚Ä¢ ${tekRafSayisi} adet tekil raf\n`;
                }
                mesaj += '\n‚ö†Ô∏è Bu i≈ülem:\n';
                mesaj += '‚úó Se√ßili raflarƒ±\n';
                mesaj += '‚úó Raflardaki T√úM √ºr√ºnleri\n';
                mesaj += '‚úó CentralStock\'tan bu √ºr√ºnlerin miktarlarƒ±nƒ±\n';
                mesaj += '\nKALICI OLARAK Sƒ∞LECEK!\n\nBu i≈ülem geri alƒ±namaz.';
                
                const onay = await showCustomModal({
                    type: 'warning',
                    title: '‚ö†Ô∏è Raf Silme Onayƒ±',
                    message: mesaj,
                    buttons: 'confirm'
                });
                
                if (!onay) {
                    return;
                }
                
                try {
                    const res = await fetch('/raf/toplu-sil', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ raf_kodlari: seciliRafKodlari })
                    });
                    
                    const result = await res.json();
                    
                    if (res.ok) {
                        await showCustomModal({
                            type: 'success',
                            title: '‚úÖ Ba≈üarƒ±lƒ±',
                            message: `${result.message}\n\nSilinen raflar:\n${result.silinen_raflar.join(', ')}`,
                            buttons: 'ok'
                        });
                        // Se√ßim modunu kapat
                        secimModuToggle();
                        // Sayfayƒ± yenile
                        location.reload();
                    } else {
                        await showCustomModal({
                            type: 'warning',
                            title: '‚ùå Hata',
                            message: `Silme i≈ülemi ba≈üarƒ±sƒ±z:\n${result.error}`,
                            buttons: 'ok'
                        });
                    }
                } catch (err) {
                    console.error('Silme hatasƒ±:', err);
                    await showCustomModal({
                        type: 'warning',
                        title: '‚ùå Hata',
                        message: 'Raflar silinirken bir hata olu≈ütu!',
                        buttons: 'ok'
                    });
                }
            }

            // SE√áƒ∞Lƒ∞ RAFLARI YAZDIRMA
            async function seciliRaflariYazdir() {
                const katCheckboxes = document.querySelectorAll('.kat-raf-cb:checked');
                const anaCheckboxes = document.querySelectorAll('.ana-raf-cb:checked');
                const ikincilCheckboxes = document.querySelectorAll('.ikincil-raf-cb:checked');
                
                if (katCheckboxes.length === 0 && anaCheckboxes.length === 0 && ikincilCheckboxes.length === 0) {
                    await showCustomModal({
                        type: 'warning',
                        title: 'Se√ßim Yok',
                        message: 'L√ºtfen yazdƒ±rmak istediƒüiniz raflarƒ± se√ßin!',
                        buttons: 'ok'
                    });
                    return;
                }
                
                // T√ºm raflarƒ± al
                const res = await fetch("/raf/api/liste");
                let tumRaflar = await res.json();
                
                let seciliRafKodlari = [];
                
                // Direkt se√ßili katlarƒ± ekle
                seciliRafKodlari.push(...Array.from(katCheckboxes).map(cb => cb.value));
                
                // Ana raf se√ßiliyse, o ana rafa ait T√úM raflarƒ± ekle
                anaCheckboxes.forEach(anaCheckbox => {
                    const anaKod = anaCheckbox.value;
                    const anaRaflar = tumRaflar.filter(r => r.kod.startsWith(anaKod + '-'));
                    seciliRafKodlari.push(...anaRaflar.map(r => r.kod));
                });
                
                // ƒ∞kincil raf se√ßiliyse, o ikincil rafa ait T√úM katlarƒ± ekle
                ikincilCheckboxes.forEach(ikincilCheckbox => {
                    const ikincilKod = ikincilCheckbox.value;
                    const ikincilRaflar = tumRaflar.filter(r => r.kod.startsWith(ikincilKod + '-'));
                    seciliRafKodlari.push(...ikincilRaflar.map(r => r.kod));
                });
                
                // Tekrarlananlarƒ± temizle
                seciliRafKodlari = [...new Set(seciliRafKodlari)];
                
                if (seciliRafKodlari.length === 0) {
                    await showCustomModal({
                        type: 'warning',
                        title: 'Raf Bulunamadƒ±',
                        message: 'Se√ßili raflara ait hi√ßbir kat bulunamadƒ±!',
                        buttons: 'ok'
                    });
                    return;
                }
                
                await raflariYazdir(seciliRafKodlari);
            }

            // T√úM RAFLARI YAZDIRMA FONKSƒ∞YONU (100x100mm etiket, 9'lu grid, ana gruplara g√∂re sƒ±ralƒ±)
            async function tumRaflariYazdir() {
                const res = await fetch("/raf/api/liste");
                const tumRaflar = await res.json();
                const tumRafKodlari = tumRaflar.map(r => r.kod);
                await raflariYazdir(tumRafKodlari);
            }

            // ORTAK YAZDIRMA FONKSƒ∞YONU
            async function raflariYazdir(rafKodlari) {
                try {
                    // T√ºm raflarƒ± al
                    const res = await fetch("/raf/api/liste");
                    let tumRaflar = await res.json();
                    
                    // Sadece se√ßili raflarƒ± filtrele
                    let raflar = tumRaflar.filter(r => rafKodlari.includes(r.kod));
                    
                    if (raflar.length === 0) {
                        alert("Yazdƒ±rƒ±lacak raf bulunamadƒ±!");
                        return;
                    }

                    // Ana kodlara g√∂re grupla ve sƒ±rala (A, B, C...)
                    raflar.sort((a, b) => {
                        // Ana kodu √ßƒ±kar (√∂rn: "A-01-02" -> "A")
                        const anaA = a.kod.split('-')[0];
                        const anaB = b.kod.split('-')[0];
                        
                        // √ñnce ana koda g√∂re, sonra t√ºm koda g√∂re sƒ±rala
                        if (anaA !== anaB) {
                            return anaA.localeCompare(anaB);
                        }
                        return a.kod.localeCompare(b.kod);
                    });

                    const printWindow = window.open("", "_blank");
                    
                    // 9'lu bloklara b√∂l (3x3 grid = 100x100mm etiket)
                    let sayfalar = '';
                    for (let i = 0; i < raflar.length; i += 9) {
                        const blok = raflar.slice(i, i + 9);
                        const etiketlerHTML = blok.map(raf => `
                            <div class="mini-etiket">
                                <img class="qr-img" src="/raf/etiket/qr/${raf.kod}">
                                <div class="kod-text">${raf.kod}</div>
                            </div>
                        `).join('');
                        
                        sayfalar += `
                            <div class="sayfa">
                                <div class="grid-container">
                                    ${etiketlerHTML}
                                </div>
                            </div>
                        `;
                    }
                    
                    printWindow.document.write(`
                        <html>
                            <head>
                                <title>T√ºm Raf Etiketleri - ${raflar.length} Adet</title>
                                <style>
                                    @page { 
                                        size: 100mm 100mm; 
                                        margin: 0; 
                                    }
                                    * {
                                        box-sizing: border-box;
                                    }
                                    body { 
                                        margin: 0;
                                        padding: 0;
                                        font-family: Arial, sans-serif;
                                    }
                                    .sayfa {
                                        width: 100mm;
                                        height: 100mm;
                                        page-break-after: always;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        padding: 2mm;
                                    }
                                    .sayfa:last-child {
                                        page-break-after: auto;
                                    }
                                    .grid-container {
                                        display: grid;
                                        grid-template-columns: repeat(3, 1fr);
                                        grid-template-rows: repeat(3, 1fr);
                                        gap: 1mm;
                                        width: 100%;
                                        height: 100%;
                                    }
                                    .mini-etiket {
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        justify-content: center;
                                        border: 0.5px solid #ddd;
                                        padding: 1mm;
                                    }
                                    .qr-img {
                                        width: 20mm;
                                        height: 20mm;
                                        object-fit: contain;
                                    }
                                    .kod-text {
                                        font-size: 15pt;
                                        font-weight: 900;
                                        text-align: center;
                                        margin-top: 1mm;
                                        word-break: break-all;
                                        line-height: 1.1;
                                    }
                                </style>
                            </head>
                            <body>
                                ${sayfalar}
                                <script>
                                    window.onload = function() {
                                        setTimeout(function() {
                                            window.print();
                                        }, 800);

                                        window.onafterprint = function() {
                                           window.close();
                                        }
                                    }
                                <\/script>
                            </body>
                        </html>
                    `);
                    printWindow.document.close();
                    
                } catch (err) {
                    console.error("Yazdƒ±rma hatasƒ±:", err);
                    alert("Etiketler y√ºklenirken bir hata olu≈ütu!");
                }
            }

            async function barkodAra(e) {
                e.preventDefault();
                const barkod = document.getElementById("barkodInput").value.trim();
                if (!barkod) return;

                const sonucDiv = document.getElementById("barkodSonuc");
                sonucDiv.innerHTML = "‚è≥ Aranƒ±yor...";

                try {
                    const res = await fetch(`/raf/api/ara/${barkod}`);
                    if (!res.ok) {
                        sonucDiv.innerHTML =
                            "<p style='color:red;'>√úr√ºn bulunamadƒ±.</p>";
                        return;
                    }
                    const data = await res.json();
                    let html = `<h5>üì¶ Barkod: ${data.barkod}</h5><ul>`;
                    data.raflar.forEach((r) => {
                        html += `<li>Raf: <b>${r.raf_kodu}</b> ‚Äì Adet: ${r.adet}</li>`;
                    });
                    html += "</ul>";
                    sonucDiv.innerHTML = html;
                } catch (err) {
                    sonucDiv.innerHTML = `<p style='color:red;'>Hata: ${err}</p>`;
                }
            }

            function openInfoModal(){
              document.getElementById('infoModalBackdrop').style.display='block';
              const wrap = document.getElementById('infoModalWrap');
              wrap.style.display='flex';
              wrap.setAttribute('aria-hidden','false');
            }function closeInfoModal(){
              document.getElementById('infoModalBackdrop').style.display='none';
              const wrap = document.getElementById('infoModalWrap');
              wrap.style.display='none';
              wrap.setAttribute('aria-hidden','true');
            }document.getElementById('infoModalBackdrop').addEventListener('click', closeInfoModal);document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeInfoModal(); });function switchInfoTab(which){
              const kisaBtn = document.getElementById('tabKisaBtn');
              const detayBtn = document.getElementById('tabDetayBtn');
              const kisa = document.getElementById('tabKisa');
              const detay = document.getElementById('tabDetay');
              if(which==='kisa'){
                kisaBtn.classList.add('active'); detayBtn.classList.remove('active');
                kisa.classList.add('active'); detay.classList.remove('active');
              }else{
                detayBtn.classList.add('active'); kisaBtn.classList.remove('active');
                detay.classList.add('active'); kisa.classList.remove('active');
              }
            }
            
            // √ñZEL MODAL FONKSƒ∞YONLARI
            function showCustomModal(options) {
                return new Promise((resolve) => {
                    const backdrop = document.getElementById('customModalBackdrop');
                    const wrap = document.getElementById('customModalWrap');
                    const icon = document.getElementById('customModalIcon');
                    const title = document.getElementById('customModalTitle');
                    const message = document.getElementById('customModalMessage');
                    const buttons = document.getElementById('customModalButtons');
                    
                    // Icon ayarla
                    if (options.type === 'warning') {
                        icon.className = 'custom-modal-icon warning';
                        icon.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i>';
                    } else if (options.type === 'success') {
                        icon.className = 'custom-modal-icon success';
                        icon.innerHTML = '<i class="bi bi-check-circle-fill"></i>';
                    }
                    
                    // ƒ∞√ßerikleri ayarla
                    title.textContent = options.title;
                    message.textContent = options.message;
                    
                    // Butonlarƒ± ayarla
                    buttons.innerHTML = '';
                    if (options.buttons === 'confirm') {
                        buttons.innerHTML = `
                            <button class="custom-modal-btn cancel" onclick="closeCustomModal(false)">ƒ∞ptal</button>
                            <button class="custom-modal-btn confirm" onclick="closeCustomModal(true)">Sil</button>
                        `;
                    } else {
                        buttons.innerHTML = `
                            <button class="custom-modal-btn ok" onclick="closeCustomModal(true)">Tamam</button>
                        `;
                    }
                    
                    // Modalƒ± g√∂ster
                    backdrop.style.display = 'block';
                    wrap.classList.add('active');
                    
                    // Promise'i sakla
                    window.customModalResolve = resolve;
                });
            }
            
            function closeCustomModal(result) {
                const backdrop = document.getElementById('customModalBackdrop');
                const wrap = document.getElementById('customModalWrap');
                backdrop.style.display = 'none';
                wrap.classList.remove('active');
                if (window.customModalResolve) {
                    window.customModalResolve(result);
                    window.customModalResolve = null;
                }
            }
        </script>
        <div class="modal-backdrop" id="infoModalBackdrop"></div><div class="modal-wrap" id="infoModalWrap" aria-hidden="true">
          <div class="modal" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle">
            <div class="modal-header">
              <h3 id="infoModalTitle">Raf Sistemi ‚Äì Kƒ±lavuz</h3>
              <button class="modal-close" onclick="closeInfoModal()" aria-label="Kapat">‚úï</button>
            </div>

            <div class="tab-bar">
              <button class="tab-btn active" id="tabKisaBtn" onclick="switchInfoTab('kisa')">Kƒ±sa √ñzet (Operasyon)</button>
              <button class="tab-btn" id="tabDetayBtn" onclick="switchInfoTab('detay')">Detaylƒ± Akƒ±≈ü (Teknik)</button>
            </div>

            <div class="tab-panel active" id="tabKisa">
              <p><span class="badge">Format</span> Raf kodu: <b>ANA-ƒ∞Kƒ∞NCƒ∞L-KAT</b> (√∂rn: <b>A-01-02</b>)</p>
              <ul class="clean">
                <li><b>Raf Olu≈ütur:</b> Formu doldur ‚Üí sistem <u>QR</u> ve <u>Code128 barkod</u> etiketi √ºretir.</li>
                <li><b>Etiket Yazdƒ±r:</b> Raf satƒ±rƒ±ndaki <i>Yazdƒ±r</i> ‚Üí anlƒ±k g√∂rsel akƒ±≈üƒ±yla yazƒ±cƒ±ya g√∂nder.</li>
                <li><b>Stok Ekle:</b> <code class="code">POST /raf/stok-ekle</code> ile barkod okut ‚Üí o rafta adet +1 (yoksa kayƒ±t a√ßƒ±lƒ±r).</li>
                <li><b>Stok G√∂r:</b> <i>Stoklarƒ± G√∂ster</i> ‚Üí model/renk/beden/adet tablosu + filtre.</li>
                <li><b>G√ºncelle:</b> satƒ±rdaki formdan adet set et; 0 yaparsan √ºr√ºn raftan silinir ve <u>CentralStock</u> aynƒ± miktar d√º≈üer.</li>
                <li><b>Barkod Ara:</b> <code class="code">GET /raf/api/ara/&lt;barkod&gt;</code> ‚Üí √ºr√ºn√ºn bulunduƒüu raflar + adetler.</li>
                <li><b>Raf Sil:</b> Raf ve i√ßindeki t√ºm √ºr√ºnler silinir; etiket dosyalarƒ± da temizlenir.</li>
              </ul>
              <p class="text-muted" style="margin-top:.5rem">
                <i class="bi bi-info-circle"></i> Listelemeler <b>adet &gt; 0</b> kuralƒ±yla gelir; √ß√∂p kayƒ±t g√∂sterilmez.
              </p>
            </div>

            <div class="tab-panel" id="tabDetay">
              <p><span class="badge">Modeller</span> <b>Raf</b>, <b>RafUrun</b>, <b>Product</b>, <b>CentralStock</b></p>
              <ul class="clean">
                <li><b>Raf olu≈üturma</b> (<code class="code">POST /raf/olustur</code>): <code>kat</code> <i>zfill(2)</i>, <code>kod=ANA-ƒ∞Kƒ∞NCƒ∞L-KAT</code> (unique). <u>static/raflar/</u> altƒ±nda <b>barcode_*.png</b> ve <b>qr_*.png</b> kaydedilir.</li>
                <li><b>Etiket akƒ±≈üƒ±</b>: <code class="code">/raf/etiket/qr/&lt;kod&gt;</code> ve <code class="code">/raf/etiket/barkod/&lt;kod&gt;</code> g√∂rselleri <i>memory stream</i> olarak d√∂ner (dosyaya yazmaz) ‚Üí yazdƒ±rma penceresi bunlarƒ± kullanƒ±r.</li>
                <li><b>Kademeli liste</b> (<code class="code">GET /raf/api/kademeli-liste</code>): <i>ANA ‚Üí ANA-ƒ∞Kƒ∞NCƒ∞L ‚Üí KAT</i> hiyerar≈üisi ve etiket yollarƒ±.</li>
                <li><b>Stok g√∂r√ºn√ºm√º</b>:
                  <ul class="clean">
                    <li><code class="code">GET /raf/api/stoklar/&lt;raf_kodu&gt;</code> ‚Üí <b>RafUrun(adet&gt;0)</b> + <b>Product</b> map‚Äôi (model/color/size).</li>
                    <li><code class="code">GET /raf/stoklar</code> ‚Üí t√ºm raflarƒ± HTML tablo olarak render.</li>
                  </ul>
                </li>
                <li><b>Stok ekleme</b> (<code class="code">POST /raf/stok-ekle</code>): payload‚Äôdaki her barkod i√ßin mevcut satƒ±r varsa <i>adet += 1</i>, yoksa <i>adet = 1</i>. <u>CentralStock burada artƒ±rƒ±lmaz</u> (operasyon tercihi).</li>
                <li><b>G√ºncelle / Sil</b>:
                  <ul class="clean">
                    <li><code class="code">POST /raf/stok-guncelle</code>: <i>adet &gt; 0</i> ‚Üí set, <i>adet ‚â§ 0</i> ‚Üí <b>RafUrun</b> silinir ve <b>CentralStock.qty</b> raftaki eski adet kadar <u>azaltƒ±lƒ±r</u>.</li>
                    <li><code class="code">POST /raf/stok-sil</code>: kayƒ±t silinir; <b>CentralStock.qty</b> raftaki adet kadar <u>azaltƒ±lƒ±r</u>.</li>
                  </ul>
                </li>
                <li><b>Arama</b>: <code class="code">GET /raf/api/ara/&lt;barkod&gt;</code> ‚Üí √ºr√ºn√ºn bulunduƒüu raflar (adet&gt;0).</li>
                <li><b>Raf silme</b> (<code class="code">POST /raf/sil/&lt;kod&gt;</code>): ili≈ükili t√ºm <b>RafUrun</b> + etiket dosyalarƒ± temizlenir; ardƒ±ndan <b>Raf</b> silinir.</li>
              </ul>
              <p style="margin-top:.5rem">
                <span class="badge">√ñneriler</span> <br/>
                ‚Ä¢ <b>Unique index</b>: <code class="code">RafUrun(raf_kodu, urun_barkodu)</code> √ßiftine unique ekleyin.<br/>
                ‚Ä¢ <b>Index</b>: <code class="code">RafUrun.raf_kodu</code>, <code class="code">RafUrun.urun_barkodu</code>, <code class="code">Product.barcode</code> index‚Äôleri performans i√ßin iyi.<br/>
                ‚Ä¢ <b>Merkez stok senk.</b>: ƒ∞sterseniz <code class="code">/raf/stok-ekle</code> i√ßinde de <b>CentralStock</b> artƒ±rma opsiyonu eklenebilir (toplu payload ile).
              </p>
            </div>
          </div></div>
        
        <!-- √ñZEL UYARI MODALI -->
        <div class="custom-modal-backdrop" id="customModalBackdrop"></div>
        <div class="custom-modal-wrap" id="customModalWrap">
            <div class="custom-modal-box">
                <div class="custom-modal-icon" id="customModalIcon">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <h3 class="custom-modal-title" id="customModalTitle">Dikkat</h3>
                <p class="custom-modal-message" id="customModalMessage"></p>
                <div class="custom-modal-buttons" id="customModalButtons"></div>
            </div>
        </div>
    </body>
</html>