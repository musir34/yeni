<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="weather-description" content="{{ weather.description if weather else 'AÃ§Ä±k Hava' }}" />
  <meta name="weather-clouds" content="{{ weather.clouds if weather else 0 }}" />
  <meta name="weather-code" content="{{ weather.weather_code if weather else 0 }}" />
  <title>Anasayfa - GÃ¼llÃ¼ AyakkabÄ±</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"/>
  <style>
    :root{ --card-bg:#ffffff; --tile-shadow:0 14px 30px rgba(0,0,0,.08); --btn-shadow:0 10px 18px rgba(0,0,0,.12); --btn-hover-shadow:0 16px 26px rgba(0,0,0,.18); --shine:linear-gradient(120deg,rgba(255,255,255,0) 30%,rgba(255,255,255,.35) 45%,rgba(255,255,255,0) 60%); }
    *{outline:0}
    body{margin:0;padding:0;font-family:"Roboto",sans-serif;background:#f5f5f5}
    #weatherCanvas{position:fixed;top:0;left:0;z-index:-1;width:100vw;height:100vh;filter:contrast(1.02) saturate(1.02)}
    .container{max-width:1200px;margin-top:60px;margin-left:auto;margin-right:auto;padding:0 15px}
    .user-info{position:fixed;top:15px;left:20px;z-index:10;font-size:14px;color:#333;display:flex;align-items:center;gap:10px;padding:10px 15px;border-radius:10px;background:rgba(255,255,255,.7);backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(0,0,0,.08);max-width:450px;}
    .user-info img{max-width:100px;height:auto;border-radius:5px;box-shadow:0 8px 18px rgba(0,0,0,.12)}
    .btn-group-top{position:fixed;top:15px;right:20px;display:flex;gap:10px;z-index:10;flex-wrap:wrap;justify-content:flex-end;align-items:center}
    .btn{border-radius:20px;padding:10px 20px;font-size:.9rem;transition:all .25s ease;box-shadow:var(--btn-shadow);border:none;color:#fff;position:relative;overflow:hidden}
    .btn::after{content:"";position:absolute;inset:0;transform:translateX(-120%);background:var(--shine);transition:transform .6s ease}
    .btn:hover::after{transform:translateX(120%)}
    .btn:hover{transform:translateY(-2px) scale(1.02);box-shadow:var(--btn-hover-shadow);text-decoration:none;color:#fff}
    .btn-secondary{background:linear-gradient(135deg,#757f9a,#d7dde8)}
    .btn-warning{background:linear-gradient(135deg,#f7971e,#ffd200)}
    .btn-primary{background:linear-gradient(135deg,#2193b0,#6dd5ed)}
    .btn-success{background:linear-gradient(135deg,#56ab2f,#a8e063)}
    .btn-info{background:linear-gradient(135deg,#667db6,#0082c8)}
    .btn-danger{background:linear-gradient(135deg,#cb2d3e,#ef473a)}
    .btn-dark{background:linear-gradient(135deg,#343a40,#495057)}
    .dropdown-menu{border:none;border-radius:12px;box-shadow:0 14px 30px rgba(0,0,0,.12)}
    .dropdown-item{font-size:.9rem}
    .card-soft{border:none;border-radius:16px;background:var(--card-bg);box-shadow:var(--tile-shadow);position:relative;overflow:hidden}
    .card-soft::before{content:"";position:absolute;top:-60%;left:-30%;width:160%;height:220%;background:radial-gradient(ellipse at top left, rgba(255,255,255,.45), transparent 60%);transform:rotate(8deg);pointer-events:none}
    .tile{transition:transform .2s ease}
    .tile:hover{transform:translateY(-3px)}
    .tile h5{margin:0;color:#666;font-weight:600}
    .tile .num{font-size:2rem;font-weight:800;color:#222;letter-spacing:.5px}
    .quick-links .btn{min-width:200px}
    .quick-links .btn i{margin-right:6px}
    .quick-links{animation:fadeUp .5s ease both}
    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .btn-pulse{animation:pulse 1.8s ease-in-out infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(203,45,62,.4)}70%{box-shadow:0 0 0 20px rgba(203,45,62,0)}100%{box-shadow:0 0 0 0 rgba(203,45,62,0)}}
    @media (max-width:768px){
      .btn{font-size:.8rem;padding:8px 12px}
      .user-info img{max-width:60px}
      .btn-group-top{top:10px;right:10px;gap:5px;flex-direction:column;align-items:flex-end}
      .container{margin-top:180px;padding:0 10px}
    }
  </style>
</head>
<body>
  <canvas id="weatherCanvas"></canvas>

  <div class="user-info">
    <img src="{{ url_for('static', filename='logo/gullu.png') }}" alt="GÃ¼llÃ¼ Shoes Logo"/>
    <div style="display:flex;flex-direction:column;gap:2px;">
      <div>GiriÅŸ Yapan: <strong>{{ session.get('first_name','') }} {{ session.get('last_name','') }}</strong></div>
      {% if weather %}
      <div style="font-size:12px;color:#555;">
        {{ weather.icon }} {{ weather.description }} â€¢ {{ weather.temperature }}Â°C
        {% if weather.feels_like %}(Hissedilen: {{ weather.feels_like }}Â°C){% endif %}
      </div>
      <div style="font-size:11px;color:#666;">
        ğŸ’¨ {{ weather.wind_speed }} km/h {{ weather.wind_direction }}
        {% if weather.wind_gusts and weather.wind_gusts > weather.wind_speed %} (ğŸŒªï¸ Åiddetli: {{ weather.wind_gusts }} km/h){% endif %}
        â€¢ ğŸ’§ Nem: {{ weather.humidity }}% â€¢ â˜ï¸ Bulutluluk: {{ weather.clouds }}%
        {% if weather.visibility %} â€¢ ğŸ‘ï¸ GÃ¶rÃ¼ÅŸ: {{ weather.visibility|round(1) }} km{% endif %}
      </div>
      {% endif %}
      {% if current_time %}
      <div style="font-size:11px;color:#666;">
        ğŸ• {{ current_time.strftime('%d %B %Y, %A - %H:%M:%S') }}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="btn-group-top">
    <a href="{{ url_for('home.home') }}" class="btn btn-secondary" title="Anasayfa"><i class="fas fa-home"></i> Anasayfa</a>

    <button class="btn btn-warning dropdown-toggle" type="button" id="kullaniciMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">KullanÄ±cÄ± Ä°ÅŸlemleri</button>
    <div class="dropdown-menu" aria-labelledby="kullaniciMenu">
      <a class="dropdown-item" href="{{ url_for('approve_users') }}">KullanÄ±cÄ± YÃ¶netimi</a>
      <a class="dropdown-item" href="{{ url_for('rapor_gir.giris') }}"><i class="fas fa-file-alt"></i> Raporlama</a>
      {% if session.get('role') in ['admin','manager'] %}
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="{{ url_for('gorev.gorev_panel') }}"><i class="fas fa-tasks"></i> GÃ¶rev Paneli</a>
        <a class="dropdown-item" href="{{ url_for('user_logs.view_logs') }}"><i class="fas fa-history"></i> KullanÄ±cÄ± Hareketleri</a>
      {% endif %}
    </div>

    <a href="{{ url_for('siparis_hazirla.index') }}" class="btn btn-danger btn-pulse" title="SipariÅŸ HazÄ±rla"><i class="fas fa-box-open"></i> SipariÅŸ HazÄ±rla</a>

    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">SipariÅŸ Ä°ÅŸlemleri</button>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="{{ url_for('siparisler_bp.yeni_siparis') }}"><i class="fas fa-plus-circle"></i> Yeni SipariÅŸ</a>
        <a class="dropdown-item" href="{{ url_for('order_list_all') }}"><i class="fas fa-list"></i> SipariÅŸ Listesi</a>
        <a class="dropdown-item" href="{{ url_for('degisim_talep') }}"><i class="fas fa-exchange-alt"></i> DeÄŸiÅŸim Talepleri</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="{{ url_for('woo.orders') }}"><i class="fas fa-shopping-cart"></i> WooCommerce SipariÅŸler</a>
        <a class="dropdown-item" href="{{ url_for('display_archive') }}"><i class="fas fa-box"></i> ArÅŸiv</a>
      </div>
    </div>

    <div class="dropdown">
      <button class="btn btn-success dropdown-toggle" data-toggle="dropdown">ÃœrÃ¼n Ä°ÅŸlemleri</button>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="{{ url_for('siparis_fisi_bp.siparis_fisi_sayfasi') }}"><i class="fas fa-dolly"></i> ÃœrÃ¼n Tedarik</a>
        <a class="dropdown-item" href="{{ url_for('product_list') }}"><i class="fas fa-tags"></i> ÃœrÃ¼n Listesi</a>
        <a class="dropdown-item" href="{{ url_for('stock_management.stock_addition_page') }}"><i class="fas fa-warehouse"></i> Stok Ekleme</a>
        <a class="dropdown-item" href="{{ url_for('raf.raf_form_sayfasi') }}"><i class="fas fa-archive"></i> Raf Listesi</a>
        <a class="dropdown-item" href="{{ url_for('iade_listesi') }}"><i class="fas fa-undo"></i> Ä°ade Listesi</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="{{ url_for('barcode_alias.index') }}"><i class="fas fa-barcode"></i> ğŸ”– Barkod Alias YÃ¶netimi</a>
      </div>
    </div>

    <div class="dropdown">
      <button class="btn btn-info dropdown-toggle" data-toggle="dropdown">Analizler</button>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="{{ url_for('analysis.sales_analysis') }}"><i class="fas fa-chart-line"></i> SatÄ±ÅŸ Analizi</a>
        <a class="dropdown-item" href="{{ url_for('openai_bp.ai_analiz') }}"><i class="fas fa-robot"></i> AI Analiz</a>
        <a class="dropdown-item" href="{{ url_for('commission_update_bp.update_commission_from_excel') }}"><i class="fas fa-file-upload"></i> Excel Komisyon YÃ¼kle</a>
        <a class="dropdown-item" href="/intelligent-stock/"><i class="fas fa-brain"></i> ğŸ§  Stok ZekasÄ±</a>
        <a class="dropdown-item" href="{{ url_for('profit.profit_report') }}"><i class="fas fa-coins"></i> ğŸ’° KÃ¢r Analizi</a>
        <a class="dropdown-item" href="{{ url_for('canli_panel.canli_panel_sayfa') }}"><i class="fas fa-broadcast-tower"></i> ğŸ“Š CanlÄ± SatÄ±ÅŸ & Stok</a>
      </div>
    </div>

    {% if session.get('role') in ['admin','manager'] %}
      <a href="{{ url_for('kasa.kasa_sayfasi') }}" class="btn btn-dark" title="Kasa"><i class="fas fa-cash-register"></i> Kasa</a>
    {% endif %}
  </div>

  <div class="container">
    <!-- HÄ±zlÄ± istatistik kutularÄ± -->
    <div class="row">
      <div class="col-md-3 mb-3">
        <div class="card-soft p-3 tile">
          <h5>ğŸ§° Toplam Stok</h5>
          <div class="num">{{ toplam_stok }}</div>
        </div>
      </div>

      {% if session.get('role') == 'admin' %}
      <div class="col-md-3 mb-3">
        <div class="card-soft p-3 tile">
          <h5>{{ ay_adi }} AylÄ±k Toplam SipariÅŸ</h5>
          <div class="num">{{ stats.toplam_siparis }}</div>
          <div style="margin-top:8px;font-size:.85rem;color:#555;">
            <div style="display:flex;justify-content:space-between;padding:4px 0;">
              <span>ğŸ“¦ Trendyol:</span>
              <strong>{{ stats.trendyol_siparis }}</strong>
            </div>
            <div style="display:flex;justify-content:space-between;padding:4px 0;">
              <span>ğŸ›’ Web Sitesi:</span>
              <strong>{{ stats.woo_siparis }}</strong>
            </div>
          </div>
          <div style="margin-top:6px;font-weight:600;color:#555;">
            Ortalama SipariÅŸ TutarÄ±:
            â‚º{{ "{:,.2f}".format(ortalama_siparis_tutari).replace(",", "X").replace(".", ",").replace("X", ".") }}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- BURADA: 'HazÄ±rlanan' yerine kÃ¼Ã§Ã¼k canlÄ± kart -->
      <div class="col-md-3 mb-3">
        <div class="card-soft p-3 tile">
          <h5>ğŸ“¦ SipariÅŸ Durumu</h5>
          
          <!-- Trendyol -->
          <div style="margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid #e0e0e0;">
            <div style="font-size:.85rem;font-weight:600;color:#f27a1a;margin-bottom:6px;">ğŸ“¦ Trendyol</div>
            <div class="d-flex flex-column" style="gap:6px;">
              <div class="d-flex align-items-center" style="gap:8px;">
                <span class="badge badge-warning badge-pill" style="font-size:.75rem;">Yeni</span>
                <span id="count-created" class="num" style="font-size:1.3rem;">{{ stats.created if stats.get('created') is not none else 0 }}</span>
              </div>
              <div class="d-flex align-items-center" style="gap:8px;">
                <span class="badge badge-success badge-pill" style="font-size:.75rem;">Ä°ÅŸlemde</span>
                <span id="count-picking" class="num" style="font-size:1.3rem;">{{ stats.picking if stats.get('picking') is not none else 0 }}</span>
              </div>
            </div>
          </div>
          
          <!-- WooCommerce -->
          <div>
            <div style="font-size:.85rem;font-weight:600;color:#7952b3;margin-bottom:6px;">ğŸ›’ Web Sitesi</div>
            <div class="d-flex flex-column" style="gap:6px;">
              <div class="d-flex align-items-center" style="gap:8px;">
                <span class="badge badge-warning badge-pill" style="font-size:.75rem;">Beklemede</span>
                <span class="num" style="font-size:1.3rem;">{{ stats.woo_onhold if stats.get('woo_onhold') is not none else 0 }}</span>
              </div>
              <div class="d-flex align-items-center" style="gap:8px;">
                <span class="badge badge-success badge-pill" style="font-size:.75rem;">Ä°ÅŸlemde</span>
                <span class="num" style="font-size:1.3rem;">{{ stats.woo_processing if stats.get('woo_processing') is not none else 0 }}</span>
              </div>
            </div>
          </div>
          
          <div class="text-muted small mt-2" id="op-last-update">Son gÃ¼ncelleme: ÅŸimdi</div>
        </div>
      </div>
      <!-- /canlÄ± kart -->

      <div class="col-md-3 mb-3">
  <div class="card-soft p-3 tile">
    <h5>Ä°ade / DeÄŸiÅŸim</h5>
    <div class="num" style="line-height:1;">{{ stats.iade }}</div>
    <div class="mt-2 d-flex flex-wrap" style="gap:6px;">
      <span class="badge" style="background:linear-gradient(135deg,#2193b0,#6dd5ed);font-size:.8rem;">
      ğŸ”„ GÃ¼nlÃ¼k DeÄŸiÅŸim: {{ stats.degisim_gunluk or 0 }}
      </span>
      <span class="badge" style="background:linear-gradient(135deg,#f7971e,#ffd200);font-size:.8rem;">
      ğŸ“… AylÄ±k DeÄŸiÅŸim: {{ stats.degisim_aylik or 0 }}
    </span>
    </div>
  </div>
</div>


    <!-- KÄ±sayollar -->
    <div class="card-soft p-4 quick-links">
      <h4 class="mb-3">HÄ±zlÄ± Ä°ÅŸlemler</h4>
      <div class="d-flex flex-wrap">
        <a class="btn btn-danger m-1" href="{{ url_for('siparis_hazirla.index') }}" title="SipariÅŸ HazÄ±rlama"><i class="fas fa-box-open"></i> SipariÅŸ HazÄ±rla</a>
        <a class="btn btn-primary m-1" href="{{ url_for('order_list_all') }}"><i class="fas fa-list"></i> SipariÅŸler</a>
        <a class="btn btn-success m-1" href="{{ url_for('product_list') }}"><i class="fas fa-tags"></i> ÃœrÃ¼n Listesi</a>
        <a class="btn btn-success m-1" href="{{ url_for('stock_management.stock_addition_page') }}"><i class="fas fa-plus-circle"></i> Stok Ekle</a>
        <a class="btn btn-warning m-1" href="{{ url_for('raf.raf_form_sayfasi') }}"><i class="fas fa-archive"></i> Raflar</a>
        <a class="btn btn-info m-1" href="{{ url_for('canli_panel.canli_panel_sayfa') }}"><i class="fas fa-chart-line"></i> ğŸ“Š CanlÄ± SatÄ±ÅŸ & Stok</a>
        <a class="btn btn-secondary m-1" href="{{ url_for('display_archive') }}"><i class="fas fa-box"></i> ArÅŸiv</a>
        <a class="btn btn-danger m-1" href="{{ url_for('iade_listesi') }}"><i class="fas fa-undo"></i> Ä°adeler</a>
        <a class="btn btn-dark  m-1" href="{{ url_for('rapor_gir.giris') }}"><i class="fas fa-file-alt"></i> Raporlama</a>
        <!-- âœ… Yeni eklenen buton -->
        <a class="btn btn-primary m-1" href="{{ url_for('uretim_oneri.uretim_oneri_haftalik_page') }}">
          <i class="fas fa-lightbulb"></i> Stok Ã–nerisi
        </a>
        <!-- WooCommerce SipariÅŸleri -->
        <a class="btn btn-info m-1" href="{{ url_for('woo.orders') }}" title="WooCommerce SipariÅŸleri">
          <i class="fas fa-shopping-cart"></i> WooCommerce SipariÅŸler
        </a>
        <!-- Idefix Paneli -->
        <a class="btn m-1" href="{{ url_for('idefix.index') }}" title="Idefix SatÄ±cÄ± Paneli" style="background: linear-gradient(135deg, #6a1b9a 0%, #8e24aa 100%); color: white;">
          <i class="fas fa-store"></i> Idefix Paneli
        </a>
      </div>
    </div>
  </div>

  <!-- Hava durumu gradient animasyonu -->
  <script>
    (function(){
      const canvas = document.getElementById('weatherCanvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener('resize', resize);

      const weatherDesc = document.querySelector('meta[name="weather-description"]')?.content || 'AÃ§Ä±k';
      const weatherClouds = parseInt(document.querySelector('meta[name="weather-clouds"]')?.content) || 0;
      const weatherCode = parseInt(document.querySelector('meta[name="weather-code"]')?.content) || 0;
      
      let colors = { top: [135, 206, 250], bottom: [255, 255, 255] }; // VarsayÄ±lan: AÃ§Ä±k mavi
      let showSun = false;
      let showClouds = false;
      let showRain = false;
      let showWind = false;
      let cloudDensity = 0;

      // Hava durumuna gÃ¶re renk paleti ve efektler
      if (weatherCode >= 95) {
        // FÄ±rtÄ±na
        colors = { top: [47, 79, 79], bottom: [105, 105, 105] };
        showClouds = true;
        showRain = true;
        showWind = true;
        cloudDensity = 8;
      } else if (weatherCode >= 80 || (weatherCode >= 61 && weatherCode <= 65)) {
        // YaÄŸmurlu
        colors = { top: [70, 130, 180], bottom: [176, 196, 222] };
        showClouds = true;
        showRain = true;
        cloudDensity = 6;
      } else if (weatherCode >= 71 && weatherCode <= 77) {
        // KarlÄ±
        colors = { top: [176, 224, 230], bottom: [240, 248, 255] };
        showClouds = true;
        cloudDensity = 5;
      } else if (weatherCode >= 51 && weatherCode <= 55) {
        // Ã‡iseleyen
        colors = { top: [119, 136, 153], bottom: [192, 192, 192] };
        showClouds = true;
        showRain = true;
        cloudDensity = 4;
      } else if (weatherCode >= 45 && weatherCode <= 48) {
        // Sisli
        colors = { top: [169, 169, 169], bottom: [211, 211, 211] };
        showClouds = true;
        cloudDensity = 7;
      } else if (weatherCode === 3 || weatherClouds > 75) {
        // KapalÄ± - GÃœNEÅ ASLA GÃ–STERILMEZ!
        colors = { top: [128, 128, 128], bottom: [192, 192, 192] };
        showClouds = true;
        showSun = false;  // KapalÄ± havada gÃ¼neÅŸ yok!
        showWind = true;  // RÃ¼zgar her zaman gÃ¶ster
        cloudDensity = 8;  // Daha yoÄŸun bulutlar
      } else if (weatherCode === 2 || weatherClouds > 50) {
        // ParÃ§alÄ± Bulutlu
        colors = { top: [135, 206, 235], bottom: [220, 220, 220] };
        showClouds = true;
        showSun = true;
        showWind = true;
        cloudDensity = 5;
      } else if (weatherCode === 1 || weatherClouds > 25) {
        // Az Bulutlu
        colors = { top: [135, 206, 250], bottom: [245, 245, 220] };
        showSun = true;
        showClouds = true;
        showWind = true;
        cloudDensity = 3;
      } else {
        // AÃ§Ä±k/GÃ¼neÅŸli
        colors = { top: [135, 206, 250], bottom: [255, 250, 205] };
        showSun = true;
        cloudDensity = 0;
      }

      // Bulutlar
      const clouds = [];
      for (let i = 0; i < cloudDensity; i++) {
        clouds.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height * 0.6,
          radius: 50 + Math.random() * 80,  // Daha bÃ¼yÃ¼k bulutlar
          speed: 0.3 + Math.random() * 0.6,  // Biraz daha hÄ±zlÄ±
          opacity: (weatherCode === 3 || weatherClouds > 75) ? 0.5 + Math.random() * 0.3 : 0.3 + Math.random() * 0.4  // KapalÄ± havada daha koyu
        });
      }

      // RÃ¼zgar Ã§izgileri
      const windLines = [];
      if (showWind) {
        for (let i = 0; i < 50; i++) {  // 30'dan 50'ye Ã§Ä±karÄ±ldÄ±
          windLines.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            length: 30 + Math.random() * 50,  // Daha uzun Ã§izgiler
            speed: 3 + Math.random() * 4,  // Daha hÄ±zlÄ±
            opacity: 0.2 + Math.random() * 0.3  // Daha belirgin
          });
        }
      }

      // YaÄŸmur damlalarÄ±
      const rainDrops = [];
      if (showRain) {
        for (let i = 0; i < 100; i++) {
          rainDrops.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            speed: 5 + Math.random() * 5,
            length: 10 + Math.random() * 20
          });
        }
      }

      let offset = 0;
      let sunX = canvas.width - 150;
      let sunY = 150;
      let sunPulse = 0;

      function animate() {
        offset += 0.0005;
        sunPulse += 0.02;
        
        // Gradient arka plan
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        const wave = Math.sin(offset) * 0.1 + 0.9;
        const top = colors.top.map(c => Math.floor(c * wave));
        const bottom = colors.bottom.map(c => Math.floor(c * (2 - wave)));
        
        gradient.addColorStop(0, `rgb(${top[0]}, ${top[1]}, ${top[2]})`);
        gradient.addColorStop(1, `rgb(${bottom[0]}, ${bottom[1]}, ${bottom[2]})`);
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // GÃ¼neÅŸ Ã§iz
        if (showSun) {
          const sunRadius = 60 + Math.sin(sunPulse) * 5;
          const sunGradient = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, sunRadius * 1.5);
          sunGradient.addColorStop(0, 'rgba(255, 220, 100, 0.9)');
          sunGradient.addColorStop(0.5, 'rgba(255, 200, 80, 0.5)');
          sunGradient.addColorStop(1, 'rgba(255, 200, 80, 0)');
          
          ctx.fillStyle = sunGradient;
          ctx.beginPath();
          ctx.arc(sunX, sunY, sunRadius * 1.5, 0, Math.PI * 2);
          ctx.fill();

          // GÃ¼neÅŸ Ä±ÅŸÄ±nlarÄ±
          ctx.strokeStyle = 'rgba(255, 220, 100, 0.3)';
          ctx.lineWidth = 3;
          for (let i = 0; i < 12; i++) {
            const angle = (i / 12) * Math.PI * 2 + offset * 2;
            const rayLength = sunRadius + 20 + Math.sin(sunPulse + i) * 10;
            ctx.beginPath();
            ctx.moveTo(sunX + Math.cos(angle) * sunRadius, sunY + Math.sin(angle) * sunRadius);
            ctx.lineTo(sunX + Math.cos(angle) * rayLength, sunY + Math.sin(angle) * rayLength);
            ctx.stroke();
          }
        }

        // Bulutlar Ã§iz
        if (showClouds) {
          clouds.forEach(cloud => {
            cloud.x += cloud.speed;
            if (cloud.x > canvas.width + 100) cloud.x = -100;

            // KapalÄ± havada gri bulutlar, diÄŸerlerinde beyaz
            const isOvercast = (weatherCode === 3 || weatherClouds > 75);
            const cloudColor = isOvercast ? `rgba(180, 180, 180, ${cloud.opacity})` : `rgba(255, 255, 255, ${cloud.opacity})`;
            ctx.fillStyle = cloudColor;
            
            // Bulut ÅŸekli (beÅŸ daire - daha gerÃ§ekÃ§i)
            ctx.beginPath();
            ctx.arc(cloud.x, cloud.y, cloud.radius, 0, Math.PI * 2);
            ctx.arc(cloud.x + cloud.radius * 0.7, cloud.y - cloud.radius * 0.2, cloud.radius * 0.9, 0, Math.PI * 2);
            ctx.arc(cloud.x - cloud.radius * 0.7, cloud.y - cloud.radius * 0.2, cloud.radius * 0.9, 0, Math.PI * 2);
            ctx.arc(cloud.x + cloud.radius * 0.4, cloud.y + cloud.radius * 0.3, cloud.radius * 0.7, 0, Math.PI * 2);
            ctx.arc(cloud.x - cloud.radius * 0.4, cloud.y + cloud.radius * 0.3, cloud.radius * 0.7, 0, Math.PI * 2);
            ctx.fill();
          });
        }

        // RÃ¼zgar Ã§izgileri Ã§iz
        if (showWind) {
          windLines.forEach(line => {
            line.x += line.speed;
            if (line.x > canvas.width) {
              line.x = -line.length;
              line.y = Math.random() * canvas.height;
            }

            ctx.strokeStyle = `rgba(255, 255, 255, ${line.opacity})`;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(line.x, line.y);
            ctx.lineTo(line.x + line.length, line.y);
            ctx.stroke();

            // KÃ¼Ã§Ã¼k yan Ã§izgiler
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(line.x + line.length * 0.3, line.y);
            ctx.lineTo(line.x + line.length * 0.3 + 8, line.y + 5);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(line.x + line.length * 0.7, line.y);
            ctx.lineTo(line.x + line.length * 0.7 + 8, line.y + 5);
            ctx.stroke();
          });
        }

        // YaÄŸmur damlalarÄ± Ã§iz
        if (showRain) {
          rainDrops.forEach(drop => {
            drop.y += drop.speed;
            if (drop.y > canvas.height) {
              drop.y = -10;
              drop.x = Math.random() * canvas.width;
            }

            ctx.strokeStyle = 'rgba(174, 194, 224, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(drop.x, drop.y);
            ctx.lineTo(drop.x, drop.y + drop.length);
            ctx.stroke();
          });
        }
        
        requestAnimationFrame(animate);
      }
      animate();
    })();
  </script>

  <!-- Ripple -->
  <script>
    document.addEventListener('click', function(e){
      const btn = e.target.closest('.btn');
      if(!btn) return;
      const circle = document.createElement('span');
      const diameter = Math.max(btn.clientWidth, btn.clientHeight);
      const radius = diameter / 2;
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - (btn.getBoundingClientRect().left + radius)}px`;
      circle.style.top  = `${e.clientY - (btn.getBoundingClientRect().top  + radius)}px`;
      circle.style.position = 'absolute';
      circle.style.borderRadius = '50%';
      circle.style.background = 'rgba(255,255,255,.35)';
      circle.style.transform = 'scale(0)';
      circle.style.animation = 'ripple 600ms ease-out';
      circle.style.pointerEvents='none';
      btn.appendChild(circle);
      setTimeout(()=>circle.remove(), 650);
    });
  </script>
  <style>@keyframes ripple { to { transform: scale(3); opacity: 0; } }</style>

  <!-- CanlÄ± Yeni/Ä°ÅŸleme AlÄ±nmÄ±ÅŸ fetch -->
  <script>
    (function () {
      const createdEl = document.getElementById('count-created');   // "Yeni"
      const pickingEl = document.getElementById('count-picking');   // "Ä°ÅŸleme AlÄ±nmÄ±ÅŸ"
      const lastEl    = document.getElementById('op-last-update');
      const intervalMs = 150000; // 2.5 dk (120000-180000 arasÄ± yapabilirsin)

      async function refreshCounts() {
        try {
          const res = await fetch('/api/home/status-counts', { cache: 'no-store' });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const data = await res.json();
          if (typeof data.created === 'number') createdEl.textContent = data.created;
          if (typeof data.picking === 'number') pickingEl.textContent = data.picking;
          lastEl.textContent = 'Son gÃ¼ncelleme: ' + new Date().toLocaleTimeString('tr-TR');
        } catch (err) {
          console.error('status refresh failed', err);
        }
      }

      refreshCounts(); // ilk yÃ¼klemede
      setInterval(refreshCounts, intervalMs);
    })();
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/weather-canvas.js') }}"></script>
</body>
</html>