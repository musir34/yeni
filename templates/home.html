<!doctype html>
<html lang="tr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Paketleme Ekranƒ± - G√ºll√º Ayakkabƒ±</title>
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        />
        <style>
            /* Sayfa D√ºzeni */
            body {
                margin: 0;
                padding: 0;
                font-family: "Roboto", sans-serif;
                background-color: #f5f5f5;
            }
            /* Canvas: Arka plan */
            #weatherCanvas {
                position: fixed;
                top: 0;
                left: 0;
                z-index: -1; /* ƒ∞√ßeriklerin arkasƒ±nda */
                width: 100vw;
                height: 100vh;
            }
            .container {
                max-width: 1200px;
                margin-top: 60px; /* Mevcut deƒüerini koruduk */
                margin-left: auto; /* Ortalamak i√ßin */
                margin-right: auto; /* Ortalamak i√ßin */
                padding: 0 15px; /* Saƒü ve sol i√ß bo≈üluk */
            }
            .user-info {
                position: fixed;
                top: 15px;
                left: 20px;
                z-index: 10;
                font-size: 14px;
                color: #333;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .user-info img {
                max-width: 100px;
                height: auto;
                border-radius: 5px;
            }
            .btn-group-top {
                position: fixed;
                top: 15px;
                right: 20px;
                display: flex;
                gap: 10px;
                z-index: 10;
                flex-wrap: wrap; /* Sƒ±ƒümazsa alt satƒ±ra insin */
                justify-content: flex-end; /* Saƒüa hizala */
                align-items: center; /* Dikeyde ortala */
            }

            /* Ortak buton g√∂r√ºn√ºm√º */
            .btn {
                border-radius: 20px;
                padding: 10px 20px;
                font-size: 0.9rem;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border: none;
                color: #fff;
            }
            .btn:hover {
                transform: scale(1.05);
                text-decoration: none;
                color: #fff; /* Hover'da yazƒ± rengi deƒüi≈ümesin */
            }

            /* Bootstrap renk sƒ±nƒ±flarƒ±nƒ± gradientlerle override edelim */
            .btn-secondary {
                background: linear-gradient(
                    to right,
                    #757f9a,
                    #d7dde8
                ); /* Gri tonlu */
                color: #fff;
            }
            .btn-warning {
                background: linear-gradient(
                    to right,
                    #f7971e,
                    #ffd200
                ); /* Turuncu-sarƒ± */
                color: #fff;
            }
            .btn-primary {
                background: linear-gradient(
                    to right,
                    #2193b0,
                    #6dd5ed
                ); /* Mavi tonlu */
                color: #fff;
            }
            .btn-success {
                background: linear-gradient(
                    to right,
                    #56ab2f,
                    #a8e063
                ); /* Ye≈üil tonlu */
                color: #fff;
            }
            .btn-info {
                background: linear-gradient(
                    to right,
                    #667db6,
                    #0082c8,
                    #0082c8,
                    #667db6
                ); /* Mavi tonlu */
                color: #fff;
            }
            .btn-danger {
                background: linear-gradient(
                    to right,
                    #cb2d3e,
                    #ef473a
                ); /* Kƒ±rmƒ±zƒ± tonlu */
                color: #fff;
            }
            /* Disabled buton rengi */
            .btn.disabled,
            .btn:disabled {
                background-color: #cccccc; /* Pasif buton arka plan */
                background-image: none; /* Gradient'i kaldƒ±r */
                cursor: not-allowed;
                opacity: 0.7;
            }

            /* Dropdown g√∂r√ºn√ºm√º */
            .dropdown-toggle {
                border-radius: 20px !important; /* Arada .btn sƒ±nƒ±fƒ± da var, override i√ßin !important */
            }
            .dropdown-menu {
                border-radius: 10px;
                padding: 0.5rem 0;
                background-color: #fff;
                border: none;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .dropdown-item {
                font-size: 0.85rem;
                padding: 0.5rem 1rem;
                color: #333;
                transition: background-color 0.3s ease;
            }
            .dropdown-item:hover {
                background-color: #efefef;
            }

            .order-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                align-items: flex-start;
                justify-content: center; /* Kartlarƒ± ortala */
            }
            .card {
                width: 200px;
                border: none;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
                margin-bottom: 20px;
                transition: transform 0.2s;
                overflow: hidden; /* Resim k√∂≈üeleri i√ßin */
                background-color: #fff;
            }
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            }
            .product-image {
                width: 100%;
                height: auto;
                border-radius: 10px 10px 0 0;
                object-fit: cover;
            }
            .card-title {
                font-weight: bold;
                color: #444;
                text-align: center;
                margin: 10px 0;
                white-space: nowrap; /* Ba≈ülƒ±k tek satƒ±rda kalsƒ±n */
                overflow: hidden; /* Ta≈üan kƒ±smƒ± gizle */
                text-overflow: ellipsis; /* Ta≈üan kƒ±sƒ±m yerine ... koy */
            }
            .card-text {
                font-size: 0.9rem;
                color: #666;
                text-align: center;
            }
            .form-control {
                border-radius: 10px;
                padding: 8px;
                font-size: 0.85rem;
                box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
                border: 1px solid #ddd;
            }
            .form-control:focus {
                border-color: #6dd5ed;
                box-shadow:
                    inset 0 1px 3px rgba(0, 0, 0, 0.1),
                    0 0 5px rgba(109, 213, 237, 0.5);
            }

            .form-group {
                position: relative;
                margin-bottom: 35px;
            }
            .alert {
                position: absolute;
                top: -30px;
                left: 0;
                right: 0;
                font-size: 12px;
                padding: 5px;
                border-radius: 5px;
                opacity: 0;
                transition: opacity 0.3s ease;
                text-align: center;
                z-index: 10;
                pointer-events: none;
                width: 100%; /* Tam geni≈ülik */
                box-sizing: border-box; /* Padding geni≈üliƒüe dahil */
            }
            .alert-show {
                opacity: 1;
            }
            .alert-success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .alert-danger {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            /* Otomatik G√∂nderim Mesaj Alanƒ± */
            #autoShipMessage {
                position: fixed;
                top: 80px; /* √úst barlarƒ±n altƒ±na yerle≈ütirildi */
                left: 0;
                right: 0;
                background-color: #e9ffe9; /* Ye≈üilimsi arkaplan */
                color: #155724; /* Koyu ye≈üil yazƒ± */
                padding: 10px 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
                z-index: 9; /* Diƒüer i√ßeriklerin √ºst√ºnde, fixed barlarƒ±n altƒ±nda */
                opacity: 0;
                visibility: hidden; /* Gizle */
                transition:
                    opacity 0.5s ease,
                    visibility 0.5s ease;
                font-size: 1rem;
                text-align: center;
                font-weight: bold;
                border-bottom: 1px solid #c3e6cb;
            }
            #autoShipMessage.show {
                opacity: 1;
                visibility: visible;
            }

            .copy-container {
                position: relative;
                cursor: pointer;
                display: inline-block;
                margin-left: 5px;
                color: #007bff;
                transition: color 0.2s ease;
            }
            .copy-container:hover {
                color: #0056b3;
            }
            .copy-confirmation {
                color: green;
                font-size: 1em;
                margin-left: 5px;
                display: none;
            }
            .copy-confirmation.show {
                display: inline-block;
            }
            .btn-bottom {
                max-width: 200px;
                margin: 10px 0;
                padding: 8px 15px;
                border-radius: 10px;
            }
            .bottom-buttons {
                text-align: left;
                margin-top: 20px;
                display: flex; /* Butonlarƒ± yan yana hizala */
                gap: 10px; /* Butonlar arasƒ±na bo≈üluk */
                flex-wrap: wrap; /* Sƒ±ƒümazsa alt satƒ±ra ge√ßsin */
            }
            .fixed-header {
                background-color: #ffffff;
                border-radius: 10px;
                padding: 15px;
                margin-top: 20px; /* Mevcut deƒüerini koruduk */
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
                /* position: fixed; top: ... Kaldƒ±rƒ±ldƒ±, container i√ßinde kalacak */
                /* left: 0; right: 0; Kaldƒ±rƒ±ldƒ± */
                /* transform: translateX(-50%); Kaldƒ±rƒ±ldƒ± */
                /* width: calc(100% - 40px); Kaldƒ±rƒ±ldƒ± */
                /* max-width: 1160px; Kaldƒ±rƒ±ldƒ± */
                z-index: auto; /* z-index'i sƒ±fƒ±rla */
            }
            .fixed-header h4 {
                margin-top: 0;
                margin-bottom: 10px;
                color: #333;
            }
            .fixed-header p {
                margin: 0;
                line-height: 1.5;
                color: #555;
            }
            /* Kargo Kodu yanƒ±na kopyalama ikonu */
            .fixed-header .copy-container {
                color: #555; /* Kargo kodu rengiyle uyumlu */
            }

            .modal-content {
                border-radius: 15px;
                padding: 20px;
            }
            .modal-header {
                border-bottom: none;
                justify-content: center;
            }
            .modal-footer {
                border-top: none;
                justify-content: center;
            }
            /* √ñzel adet stili: Adet 1'den fazla ise kƒ±rmƒ±zƒ± ve b√ºy√ºk g√∂ster */
            .highlight-quantity {
                color: red;
                font-size: 1.3em;
                font-weight: bold;
            }

            /* Bootstrap custom switch stili */
            .custom-control {
                position: relative; /* Toggle switch i√ßin gerekli */
                display: inline-flex; /* Butonlarla yan yana */
                min-height: 1.5rem; /* Minimum y√ºkseklik */
                padding-left: 1.5rem; /* Label i√ßin sola bo≈üluk */
                align-items: center; /* Dikeyde ortala */
            }
            .custom-switch {
                padding-left: 2.25rem; /* Switch i√ßin daha fazla bo≈üluk */
            }
            .custom-control-input {
                position: absolute;
                left: 0;
                z-index: -1;
                width: 1rem;
                height: 1.25rem;
                opacity: 0; /* Orijinal inputu gizle */
            }
            .custom-control-label {
                margin-bottom: 0;
                line-height: 1.5;
                cursor: pointer;
            }
            .custom-control-label::before {
                position: absolute;
                top: 0.25rem;
                left: -2.25rem;
                display: block;
                width: 1.75rem; /* Toggle arka plan geni≈üliƒüi */
                height: 1rem; /* Toggle arka plan y√ºksekliƒüi */
                pointer-events: none;
                content: "";
                background-color: #adb5bd; /* Pasif arka plan rengi */
                border: #adb5bd solid 1px; /* Kenarlƒ±k */
                border-radius: 1rem; /* Tam yuvarlak kenar */
                transition:
                    background-color 0.15s ease-in-out,
                    border-color 0.15s ease-in-out,
                    box-shadow 0.15s ease-in-out;
            }
            .custom-control-label::after {
                position: absolute;
                top: 0.25rem;
                left: -2rem; /* Toggle topu pozisyonu */
                display: block;
                width: 1rem; /* Toggle top boyutu */
                height: 1rem;
                content: "";
                background-color: #fff; /* Toggle top rengi */
                border-radius: 1rem; /* Tam yuvarlak */
                transition:
                    transform 0.15s ease-in-out,
                    background-color 0.15s ease-in-out,
                    border-color 0.15s ease-in-out,
                    box-shadow 0.15s ease-in-out;
            }
            .custom-switch
                .custom-control-input:checked
                ~ .custom-control-label::before {
                color: #fff;
                border-color: #28a745; /* Aktif kenarlƒ±k rengi */
                background-color: #28a745; /* Aktif arka plan rengi */
            }
            .custom-switch
                .custom-control-input:checked
                ~ .custom-control-label::after {
                transform: translateX(0.75rem); /* Saƒüa kaydƒ±r */
            }

            @media (max-width: 768px) {
                .btn {
                    font-size: 0.8rem;
                    padding: 8px 12px;
                }
                .card-title {
                    font-size: 0.9rem;
                }
                .card-text {
                    font-size: 0.8rem;
                }
                .user-info img {
                    max-width: 70px;
                }
                /* Mobil cihazlarda √ºst sabit elementlerin d√ºzeni bozulabilir */
                /* Bu √ßok temel bir √∂rnek, detaylƒ± responsive tasarƒ±m i√ßin daha fazla medya sorgusu gerekebilir */
                .user-info {
                    top: 10px;
                    left: 10px;
                    gap: 5px;
                    font-size: 12px;
                }
                .user-info img {
                    max-width: 60px;
                }
                .btn-group-top {
                    top: 10px;
                    right: 10px;
                    gap: 5px;
                    flex-direction: column; /* Mobil altƒ±nda alt alta */
                    align-items: flex-end; /* Saƒüa hizala */
                }
                .btn {
                    width: 100%; /* Tam geni≈ülik */
                    text-align: center; /* Ortala */
                    padding: 6px 10px;
                    font-size: 0.8rem;
                }
                .dropdown-toggle {
                    width: 100%;
                    text-align: center !important; /* Ortala */
                }
                .dropdown-menu {
                    left: auto !important; /* Bootstrap'in left:0 stilini ez */
                    right: 0 !important; /* Saƒüa hizala */
                    min-width: auto; /* Minimum geni≈üliƒüi kaldƒ±r */
                    width: auto; /* Geni≈üliƒüi i√ßeriƒüe g√∂re ayarla */
                }
                .dropdown-item {
                    text-align: right; /* Saƒüdan hizala */
                    font-size: 0.8rem;
                }
                .custom-switch {
                    margin-top: 10px; /* Buton grubundan bo≈üluk */
                    width: 100%; /* Tam geni≈ülik */
                    justify-content: flex-end; /* Saƒüa hizala */
                    padding-right: 2.25rem; /* Sola padding yerine saƒüa */
                    padding-left: 0; /* Sola padding'i kaldƒ±r */
                }
                .custom-control-label::before {
                    left: auto; /* Sola sabitlemeyi kaldƒ±r */
                    right: 0; /* Saƒüa sabitle */
                }
                .custom-control-label::after {
                    left: auto; /* Sola sabitlemeyi kaldƒ±r */
                    right: 0.25rem; /* Saƒüa sabitle ve biraz bo≈üluk bƒ±rak */
                }
                .custom-switch
                    .custom-control-input:checked
                    ~ .custom-control-label::after {
                    transform: translateX(
                        -0.75rem
                    ); /* Sola kaydƒ±r (saƒüdan sola) */
                }
                #autoShipMessage {
                    top: 120px; /* √úst fixed bar'ƒ±n altƒ±na yerle≈ütir */
                    padding: 8px 10px;
                    font-size: 0.9rem;
                }
                .container {
                    margin-top: 180px; /* Fixed header ve mesajƒ±n altƒ±na bo≈üluk */
                    padding: 0 10px;
                }
                .fixed-header {
                    margin-top: 10px; /* Container'ƒ±n i√ßinde √ºstten bo≈üluk */
                    padding: 10px;
                }
            }
            @media (max-width: 576px) {
                /* √áok k√º√ß√ºk ekranlar */
                .card {
                    width: calc(50% - 15px); /* Yan yana 2 kart */
                }
                .user-info {
                    width: 100%;
                    justify-content: center;
                }
                .btn-group-top {
                    width: 100%;
                    justify-content: center;
                }
                .custom-switch {
                    justify-content: center; /* Ortala */
                    padding-right: 2.25rem;
                }
                .custom-control-label::before {
                    right: auto;
                    left: 50%;
                    transform: translateX(-150%);
                }
                .custom-control-label::after {
                    right: auto;
                    left: 50%;
                    transform: translateX(-50%);
                }
                .custom-switch
                    .custom-control-input:checked
                    ~ .custom-control-label::after {
                    transform: translateX(50%);
                }
            }
        </style>
    </head>
    <body>
        <canvas id="weatherCanvas"></canvas>

        <div class="user-info">
            <img src="static/logo/gullu.png" alt="G√ºll√º Shoes Logo" />
            Giri≈ü Yapan:
            <strong
                >{{ session['first_name'] }} {{ session['last_name'] }}</strong
            >
        </div>

        <div class="btn-group-top">
            <a href="{{ url_for('home.home') }}" class="btn btn-secondary"
                >Anasayfa</a
            >
            <a href="{{ url_for('display_archive') }}" class="btn btn-secondary"
                >Ar≈üiv</a
            >

            <div class="dropdown">
                <button
                    class="btn btn-warning dropdown-toggle"
                    type="button"
                    id="kullaniciMenu"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                >
                    Kullanƒ±cƒ± ƒ∞≈ülemleri
                </button>
                <div class="dropdown-menu" aria-labelledby="kullaniciMenu">
                    <a
                        class="dropdown-item"
                        href="{{ url_for('approve_users') }}"
                        >Kullanƒ±cƒ± Y√∂netimi</a
                    >
                    {% if session['role'] in ['admin', 'manager'] %}
                    <a
                        class="dropdown-item"
                        href="{{ url_for('user_logs.view_logs') }}"
                    >
                        <i class="fas fa-history"></i> Kullanƒ±cƒ± Hareketleri
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="dropdown">
                <button
                    class="btn btn-primary dropdown-toggle"
                    type="button"
                    id="siparisMenu"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                >
                    Sipari≈ü ƒ∞≈ülemleri
                </button>
                <div class="dropdown-menu" aria-labelledby="siparisMenu">
                    <a
                        class="dropdown-item"
                        href="{{ url_for('siparisler_bp.yeni_siparis') }}"
                        >Yeni Sipari≈ü</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('order_list_all') }}"
                        >Sipari≈ü Listesi</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('degisim_talep') }}"
                        >Deƒüi≈üim Talepleri</a
                    >
                </div>
            </div>

            <div class="dropdown">
                <button
                    class="btn btn-success dropdown-toggle"
                    type="button"
                    id="urunMenu"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                >
                    √úr√ºn ƒ∞≈ülemleri
                </button>
                <div class="dropdown-menu" aria-labelledby="urunMenu">
                    <a
                        class="dropdown-item"
                        href="{{ url_for('siparis_fisi_bp.siparis_fisi_sayfasi') }}"
                        >√úr√ºn Tedarik Sayfasƒ±</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('product_list') }}"
                        >√úr√ºn Listesi</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('stock_management.stock_addition_screen') }}"
                        >Stok Ekleme</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('iade_listesi') }}"
                        >ƒ∞ade Listesi</a
                    >
                </div>
            </div>

            <div class="dropdown">
                <button
                    class="btn btn-info dropdown-toggle"
                    type="button"
                    id="analizMenu"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                >
                    Analizler
                </button>
                <div class="dropdown-menu" aria-labelledby="analizMenu">
                    <a
                        class="dropdown-item"
                        href="{{ url_for('analysis.sales_analysis') }}"
                        >Satƒ±≈ü Analizi</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('openai_bp.ai_analiz') }}"
                        >AI Analiz</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('commission_update_bp.update_commission_from_excel') }}"
                        >Excel Komisyon Y√ºkle</a
                    >
                    <a
                        class="dropdown-item"
                        href="{{ url_for('profit.profit_report') }}"
                        >K√¢r-Zarar Analizi</a
                    >
                    <a class="dropdown-item" href="/intelligent-stock/"
                        >üß† Stok Zekasƒ± Paneli</a
                    >
                    <!-- Bu satƒ±rƒ± ekledim -->
                </div>
            </div>

            <div class="custom-control custom-switch">
                <input
                    type="checkbox"
                    class="custom-control-input"
                    id="autoShipToggle"
                />
                <label class="custom-control-label" for="autoShipToggle"
                    >Otomatik G√∂nderim</label
                >
            </div>
        </div>

        <div id="autoShipMessage">
            <strong>Otomatik G√∂nderim Aktif:</strong> Kargo kodu:
            <span id="autoShipBarcode"></span>
        </div>

        <div class="container">
            <form
                method="POST"
                action="{{ url_for('confirm_packing') }}"
                id="packingForm"
                autocomplete="off"
            >
                <input
                    type="hidden"
                    name="order_number"
                    value="{{ order_number }}"
                />

                <div class="order-container">
                    {% for product in products %}
                    <div class="col-sm-6 col-md-4 col-lg-2 col-xl-2">
                        <div
                            class="card product-card"
                            data-order-number="{{ order_number }}"
                        >
                            <img
                                src="{{ product.image_url }}"
                                alt="√úr√ºn G√∂rseli"
                                class="card-img-top product-image"
                            />
                            <div class="card-body">
                                <h5 class="card-title">{{ product.sku }}</h5>
                                <p class="card-text">
                                    <strong>Miktar:</strong>
                                    {# Miktar 1'den b√ºy√ºkse highlight-quantity
                                    sƒ±nƒ±fƒ±nƒ± ekle #}
                                    <span
                                        class="{% if product.quantity and product.quantity > 1 %}highlight-quantity{% endif %}"
                                    >
                                        {{ product.quantity if product.quantity
                                        else 1 }}
                                    </span>
                                </p>
                                <p class="card-text">
                                    <strong>√úr√ºn Barkodu:</strong>
                                    <span id="productBarcode-{{ loop.index0 }}"
                                        >{{ product.barcode }}</span
                                    >
                                    <span class="copy-container">
                                        <span
                                            class="clipboard-icon"
                                            onclick="copyToClipboard('productBarcode-{{ loop.index0 }}', this)"
                                            >üìã</span
                                        >
                                        <span class="copy-confirmation"
                                            >‚úîÔ∏è</span
                                        >
                                    </span>
                                </p>
                                <div class="form-group">
                                    <div
                                        id="barkodMatchMessage-right-{{ loop.index0 }}"
                                        class="alert"
                                    ></div>
                                    <input
                                        type="text"
                                        class="form-control barkod-input"
                                        data-product-index="{{ loop.index0 }}"
                                        data-side="right"
                                        id="barkodInput-right-{{ loop.index0 }}"
                                        name="barkod_right_{{ loop.index0 }}"
                                        placeholder="{{ product.sku }} Saƒü Tek Barkodu"
                                        required
                                        autocomplete="off"
                                    />
                                    <input
                                        type="hidden"
                                        id="expectedBarcode-right-{{ loop.index0 }}"
                                        value="{{ product.barcode }}"
                                    />
                                </div>
                                <div class="form-group">
                                    <div
                                        id="barkodMatchMessage-left-{{ loop.index0 }}"
                                        class="alert"
                                    ></div>
                                    <input
                                        type="text"
                                        class="form-control barkod-input"
                                        data-product-index="{{ loop.index0 }}"
                                        data-side="left"
                                        id="barkodInput-left-{{ loop.index0 }}"
                                        name="barkod_left_{{ loop.index0 }}"
                                        placeholder="{{ product.sku }} Sol Tek Barkodu"
                                        required
                                        autocomplete="off"
                                    />
                                    <input
                                        type="hidden"
                                        id="expectedBarcode-left-{{ loop.index0 }}"
                                        value="{{ product.barcode }}"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="bottom-buttons">
                    <button
                        type="submit"
                        class="btn btn-primary btn-bottom disabled"
                        id="onaylaBtn"
                        disabled
                    >
                        Paketlemeyi Onayla
                    </button>
                </div>
            </form>

            <div class="bottom-buttons">
                <form
                    method="POST"
                    action="{{ url_for('order_label') }}"
                    target="_blank"
                    id="yazdirForm"
                    autocomplete="off"
                >
                    <input
                        type="hidden"
                        name="order_number"
                        value="{{ order_number }}"
                    />
                    <input
                        type="hidden"
                        name="shipping_barcode"
                        value="{{ shipping_barcode }}"
                    />
                    <input
                        type="hidden"
                        name="cargo_provider"
                        value="{{ cargo_provider_name }}"
                    />
                    <input
                        type="hidden"
                        name="customer_name"
                        value="{{ customer_name }}"
                    />
                    <input
                        type="hidden"
                        name="customer_surname"
                        value="{{ customer_surname }}"
                    />
                    <input
                        type="hidden"
                        name="customer_address"
                        value="{{ customer_address }}"
                    />
                    <button
                        type="submit"
                        class="btn btn-warning btn-bottom disabled"
                        id="yazdirBtn"
                        disabled
                    >
                        Yazdƒ±r
                    </button>
                </form>
                <button
                    type="button"
                    class="btn btn-danger btn-bottom"
                    onclick="showArchiveModal('{{ order_number }}')"
                >
                    Ar≈üive G√∂nder
                </button>
            </div>

            <div class="fixed-header">
                <h4>Kargo Bilgileri</h4>
                <p>
                    <strong>Sipari≈ü No:</strong> {{ order_number }}<br />
                    <strong>M√º≈üteri:</strong> {{ customer_name }} {{
                    customer_surname }}<br />
                    <strong>Kargoya Kalan S√ºre:</strong> {{ remaining_time }}<br />
                    <strong>Kargo Firmasƒ±:</strong> {{ cargo_provider_name }}<br />
                    <strong>Kargo Kodu:</strong>
                    <span id="shippingBarcode">{{ shipping_barcode }}</span>
                    {# Kargo kodu yanƒ±na kopyalama ikonu eklendi #}
                    <span class="copy-container">
                        <span
                            class="clipboard-icon"
                            onclick="copyToClipboard('shippingBarcode', this)"
                            >üìã</span
                        >
                        <span class="copy-confirmation">‚úîÔ∏è</span>
                    </span>
                </p>
            </div>

            <div
                class="modal fade"
                id="archiveModal"
                tabindex="-1"
                aria-labelledby="archiveModalLabel"
                aria-hidden="true"
            >
                <div class="modal-dialog">
                    <form id="archiveForm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    Ar≈üivleme Sebebi Se√ßin
                                </h5>
                                <button
                                    type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="Kapat"
                                >
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <input
                                    type="hidden"
                                    id="archiveOrderNumber"
                                    name="order_number"
                                    value=""
                                />
                                <div class="mb-3">
                                    <label
                                        for="archiveReason"
                                        class="form-label"
                                        >Sebep</label
                                    >
                                    <select
                                        class="form-control"
                                        id="archiveReason"
                                        name="archive_reason"
                                        required
                                    >
                                        <option value="">Sebep Se√ßin</option>
                                        <option value="Stok T√ºkendi">
                                            Stok T√ºkendi
                                        </option>
                                        <option value="Kusurlu/Defolu √úr√ºn">
                                            Kusurlu/Defolu √úr√ºn
                                        </option>
                                        <option value="Paket ƒ∞√ßeriƒüi Eksik">
                                            Paket ƒ∞√ßeriƒüi Eksik
                                        </option>
                                        <option value="√úr√ºn Sorunu Gideriliyor">
                                            √úr√ºn Sorunu Gideriliyor
                                        </option>
                                        <option value="Diƒüer">
                                            Diƒüer (A√ßƒ±klama Ekleyin)
                                        </option>
                                    </select>
                                </div>
                                {# Diƒüer sebep i√ßin metin alanƒ± eklendi #}
                                <div
                                    class="mb-3"
                                    id="otherReasonDiv"
                                    style="display: none"
                                >
                                    <label
                                        for="otherReasonText"
                                        class="form-label"
                                        >Diƒüer Sebep A√ßƒ±klamasƒ±</label
                                    >
                                    <textarea
                                        class="form-control"
                                        id="otherReasonText"
                                        name="other_reason"
                                        rows="3"
                                    ></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-dismiss="modal"
                                >
                                    ƒ∞ptal
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Ar≈üivle
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div
                class="toast"
                id="archiveSuccessToast"
                role="alert"
                aria-live="assertive"
                aria-atomic="true"
                data-delay="2000"
                style="position: fixed; top: 20px; right: 20px; z-index: 9999"
            >
                <div class="toast-header">
                    <strong class="mr-auto text-success">Ba≈üarƒ±lƒ±</strong>
                    <small>≈ûimdi</small>
                    <button
                        type="button"
                        class="ml-2 mb-1 close"
                        data-dismiss="toast"
                        aria-label="Kapat"
                    >
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="toast-body">Sipari≈ü ar≈üivlendi!</div>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>

        <script>
            const canvas = document.getElementById("weatherCanvas");
            const ctx = canvas.getContext("2d");

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();

            function getIstanbulTime() {
                try {
                    return new Date(
                        new Date().toLocaleString("en-US", {
                            timeZone: "Europe/Istanbul",
                        }),
                    );
                } catch (e) {
                    console.error("Saat dilimi hatasƒ±:", e);
                    return new Date();
                }
            }
            function getIstanbulHour() {
                return getIstanbulTime().getHours();
            }

            function drawBackground() {
                const hour = getIstanbulHour();
                if (hour >= 6 && hour < 18) {
                    ctx.fillStyle = "#87CEEB"; // g√ºnd√ºz
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    drawSun();
                    drawClouds();
                } else {
                    ctx.fillStyle = "#2c3e50"; // gece
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    drawMoon();
                    drawStars();
                }
            }

            function drawSun() {
                const hour = getIstanbulHour();
                // G√ºn doƒüumu ve batƒ±mƒ± i√ßin pozisyon ayarƒ± (6-18 arasƒ±)
                let sunProgress = 0; // 0 (doƒüu≈ü) - 1 (batƒ±≈ü)
                if (hour >= 6 && hour < 12) {
                    sunProgress = (hour - 6) / 6; // Sabah 6'dan 12'ye
                } else if (hour >= 12 && hour < 18) {
                    sunProgress = 1 - (hour - 12) / 6; // √ñƒülen 12'den ak≈üam 6'ya
                } else {
                    // Gece veya 6'dan √∂nce/18'den sonra g√ºne≈üi g√∂sterme
                    return;
                }

                const sunX =
                    canvas.width * 0.1 + sunProgress * (canvas.width * 0.8); // Soldan saƒüa hareket (geni≈üliƒüin %10'undan %90'ƒ±na)
                const sunY =
                    canvas.height * 0.9 -
                    Math.sin(sunProgress * Math.PI) * canvas.height * 0.8; // Yarƒ±m daire hareketi (ufuk √ßizgisinden tepeye)

                ctx.beginPath();
                const gradient = ctx.createRadialGradient(
                    sunX,
                    sunY,
                    20,
                    sunX,
                    sunY,
                    60,
                );
                gradient.addColorStop(0, "#FFD700");
                gradient.addColorStop(1, "#FFA500");
                ctx.fillStyle = gradient;
                ctx.arc(sunX, sunY, 60, 0, 2 * Math.PI);
                ctx.fill();
            }

            let clouds = [];
            const cloudCount = 5;
            function createCloud() {
                return {
                    x: Math.random() * (canvas.width + 200) - 100, // Ekran dƒ±≈üƒ±ndan ba≈ülayabilir
                    y: Math.random() * canvas.height * 0.3,
                    width: 120 + Math.random() * 80,
                    height: 60 + Math.random() * 20,
                    speed: 0.3 + Math.random() * 0.5,
                };
            }
            function initClouds() {
                clouds = []; // Yeniden ba≈ülat
                for (let i = 0; i < cloudCount; i++) {
                    clouds.push(createCloud());
                }
            }
            initClouds();

            function drawClouds() {
                clouds.forEach((cloud) => {
                    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                    // Daha doƒüal bulut ≈üekli √ßizimi (birden √ßok daire)
                    ctx.beginPath();
                    ctx.arc(
                        cloud.x,
                        cloud.y,
                        cloud.width * 0.3,
                        0,
                        Math.PI * 2,
                    );
                    ctx.arc(
                        cloud.x + cloud.width * 0.3,
                        cloud.y - cloud.height * 0.2,
                        cloud.width * 0.25,
                        0,
                        Math.PI * 2,
                    );
                    ctx.arc(
                        cloud.x + cloud.width * 0.6,
                        cloud.y,
                        cloud.width * 0.35,
                        0,
                        Math.PI * 2,
                    );
                    ctx.arc(
                        cloud.x + cloud.width * 0.4,
                        cloud.y + cloud.height * 0.2,
                        cloud.width * 0.2,
                        0,
                        Math.PI * 2,
                    );
                    ctx.fill();
                });
                updateClouds();
            }
            function updateClouds() {
                clouds.forEach((cloud) => {
                    cloud.x += cloud.speed;
                    if (cloud.x - cloud.width > canvas.width) {
                        cloud.x = -cloud.width;
                        cloud.y = Math.random() * canvas.height * 0.3;
                        cloud.speed = 0.3 + Math.random() * 0.5; // Hƒ±zƒ± da rastgele yap
                    }
                });
            }

            function drawMoon() {
                const moonX = canvas.width * 0.8;
                const moonY = canvas.height * 0.2;
                ctx.beginPath();
                ctx.fillStyle = "#F0E68C"; // Soluk altƒ±n sarƒ±sƒ±
                ctx.arc(moonX, moonY, 40, 0, 2 * Math.PI);
                ctx.fill();

                // Hilal ≈üekli vermek i√ßin √ºzerine koyu renk bir daire √ßiz
                ctx.beginPath();
                ctx.fillStyle = "#2c3e50"; // Gece g√∂ky√ºz√º rengiyle aynƒ±
                ctx.arc(moonX + 15, moonY - 5, 40, 0, 2 * Math.PI); // Ayƒ±n biraz saƒüƒ±na ve yukarƒ±sƒ±na kaydƒ±r
                ctx.fill();
            }

            let stars = [];
            const starCount = 100;
            function createStar() {
                return {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.2,
                    alpha: Math.random() * 0.7 + 0.3, // Parlama efekti i√ßin ≈üeffaflƒ±k
                };
            }
            function initStars() {
                stars = []; // Yeniden ba≈ülat
                for (let i = 0; i < starCount; i++) {
                    stars.push(createStar());
                }
            }
            initStars();
            function drawStars() {
                ctx.fillStyle = "white";
                stars.forEach((star) => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, 2 * Math.PI);
                    ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`; // ≈ûeffaflƒ±ƒüƒ± kullan
                    ctx.fill();

                    // Parlama efekti i√ßin ≈üeffaflƒ±ƒüƒ± hafif√ße deƒüi≈ütir
                    star.alpha += (Math.random() - 0.5) * 0.02; // √áok yava≈ü deƒüi≈ütir
                    if (star.alpha > 1) star.alpha = 1;
                    if (star.alpha < 0.3) star.alpha = 0.3;
                });
            }

            function animateBackground() {
                requestAnimationFrame(animateBackground);
                drawBackground();
            }
            animateBackground();
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
            const barkodInputs = document.querySelectorAll('.barkod-input');
            const onaylaBtn = document.getElementById('onaylaBtn');
            const yazdirBtn = document.getElementById('yazdirBtn');
            const yazdirForm = document.getElementById('yazdirForm');
            const autoShipToggle = document.getElementById('autoShipToggle'); // Toggle elementi
            const autoShipMessage = document.getElementById('autoShipMessage'); // Mesaj elementi
            const autoShipBarcodeSpan = document.getElementById('autoShipBarcode'); // Mesaj i√ßindeki barkod spanƒ±
            const shippingBarcode = "{{ shipping_barcode }}"; // Kargo barkodunu Flask'tan al
            const packingForm = document.getElementById('packingForm'); // Form elementi


            const productCount = {{ products|length }};
            let barkodDogruList = new Array(productCount).fill(false);

            let printTimer = null; // Yazdƒ±rma timerƒ±
            let confirmTimer = null; // Onay timerƒ±
            let messageTimer = null; // Mesaj gizleme timerƒ±

            // ### LOCAL STORAGE: Toggle durumunu y√ºkle ###
            const savedToggleState = localStorage.getItem('autoShipEnabled');
            if (savedToggleState !== null) {
            // localStorage'dan alƒ±nan deƒüer stringtir, boolean'a √ßevir
            autoShipToggle.checked = savedToggleState === 'true';
            }
            // ### LOCAL STORAGE: Y√ºkleme Bitti ###


            // T√ºm timerlarƒ± ve mesajƒ± temizleme fonksiyonu
            function clearAllTimersAndHideMessage() {
            if (printTimer) clearTimeout(printTimer);
            if (confirmTimer) clearTimeout(confirmTimer);
            if (messageTimer) clearTimeout(messageTimer);
            autoShipMessage.classList.remove('show');
            }

            // Otomatik G√∂nderim mesajƒ±nƒ± g√∂ster
            function showAutoShipMessage() {
            // clearMessageTimerAndHide(); // Sadece mesaj timerƒ±nƒ± temizlemek yerine t√ºm timerlarƒ± temizledik yukarƒ±da
            autoShipBarcodeSpan.innerText = shippingBarcode;
            autoShipMessage.classList.add('show');
            // Mesajƒ± 3 saniye sonra gizle
            messageTimer = setTimeout(() => {
            autoShipMessage.classList.remove('show');
            }, 3000);
            }


            // Butonlarƒ±n durumunu g√ºncelle ve timerlarƒ± ayarla
            function updateButtonStates() {
            const allBarcodesMatched = barkodDogruList.every(Boolean);

            // √ñnceki t√ºm timerlarƒ± temizle (Yeni bir set ba≈ülatƒ±lacak veya hi√ß ba≈ülatƒ±lmayacak)
            clearAllTimersAndHideMessage();

            if (allBarcodesMatched) {
            // T√ºm barkodlar doƒüruysa butonlarƒ± aktifle≈ütir
            onaylaBtn.classList.remove('disabled');
            yazdirBtn.classList.remove('disabled');
            onaylaBtn.disabled = false;
            yazdirBtn.disabled = false;

            // ONAYLAMA timerƒ± HER ZAMAN ba≈ülar (15 saniye)
            confirmTimer = setTimeout(() => {
            console.log("Otomatik onayla √ßalƒ±≈ütƒ±"); // Debug i√ßin
            // Formu manuel olarak submit et
            packingForm.submit();
            }, 15000);


            if (autoShipToggle.checked) {
            // Toggle A√áIK ise: Otomatik G√∂nderim mesajƒ±nƒ± g√∂ster
            showAutoShipMessage();
            // Yazdƒ±rma timerƒ± BA≈ûLATILMAZ (Toggle a√ßƒ±kken sadece onay timerƒ±)
            } else {
            // Toggle KAPALI ise: Yazdƒ±rma timerƒ± BA≈ûLATILIR (5 saniye)
            printTimer = setTimeout(() => {
            console.log("Otomatik yazdƒ±r √ßalƒ±≈ütƒ±"); // Debug i√ßin
            yazdirForm.submit();
            }, 5000);
            // Otomatik G√∂nderim mesajƒ± Gƒ∞ZLENƒ∞R (clearAllTimersAndHideMessage i√ßinde yapƒ±ldƒ±)
            }

            } else {
            // T√ºm barkodlar doƒüru deƒüilse butonlarƒ± pasifle≈ütir
            onaylaBtn.classList.add('disabled');
            yazdirBtn.classList.add('disabled');
            onaylaBtn.disabled = true;
            yazdirBtn.disabled = true;
            // Barkodlar yanlƒ±≈üsa T√úM timerlarƒ± (mesaj dahil) temizle (Yukarƒ±da yapƒ±ldƒ±)
            }
            }

            // Form submit i≈ülemini izleyelim
            packingForm.addEventListener('submit', function(event) {
                console.log("Form submit edildi - packingForm");
                console.log("Form verisi:", new FormData(packingForm));
                console.log("Form action:", packingForm.action);
                console.log("Form method:", packingForm.method);

                // Form disable durumunu kontrol et
                const disabledInputs = packingForm.querySelectorAll('input:disabled, button:disabled');
                console.log("Disabled elements in form:", disabledInputs.length);

                // Form i√ßindeki order_number hidden input'unun deƒüerini kontrol et
                const orderNumberInput = packingForm.querySelector('input[name="order_number"]');
                console.log("order_number input value:", orderNumberInput ? orderNumberInput.value : "yok");
            });

            // Onay butonuna √∂zel tƒ±klama event listener'ƒ± ekle
            onaylaBtn.addEventListener('click', function(event) {
                console.log("onaylaBtn tƒ±klandƒ±");
                console.log("Button state - disabled:", onaylaBtn.disabled);
                console.log("Button class:", onaylaBtn.className);
            });


            // ƒ∞lk input'a odaklansƒ±n
            if (barkodInputs.length > 0) {
            barkodInputs[0].focus();
            }

            barkodInputs.forEach((input, index) => {
            input.addEventListener('input', function () {
            const side = input.dataset.side;
            const productIndex = parseInt(input.dataset.productIndex);
            const expectedBarcode = document.getElementById(`expectedBarcode-${side}-${productIndex}`).value;
            const matchMessage = document.getElementById(`barkodMatchMessage-${side}-${productIndex}`);
            const inputValue = input.value.trim();
            const expectedValue = expectedBarcode.trim();

            // Mesajƒ± temizle
            matchMessage.classList.remove('alert-success', 'alert-danger', 'alert-show');
            matchMessage.textContent = '';
            // Input arka plan rengini sƒ±fƒ±rla
            input.style.backgroundColor = '';


            if (inputValue === expectedValue) {
            matchMessage.classList.add('alert-success', 'alert-show');
            matchMessage.textContent = 'Barkod doƒüru!';
            input.style.backgroundColor = '#e9ffe9'; // Ye≈üil arka plan

            // barkodDogruList'i g√ºncellemek i√ßin ilgili √ºr√ºn√ºn her iki barkodunu da kontrol et
            const rightInput = document.getElementById(`barkodInput-right-${productIndex}`);
            const leftInput = document.getElementById(`barkodInput-left-${productIndex}`);
            const expectedRight = document.getElementById(`expectedBarcode-right-${productIndex}`).value.trim();
            const expectedLeft = document.getElementById(`expectedBarcode-left-${productIndex}`).value.trim();

            // ƒ∞ki input da doƒüru girilmi≈üse, o √ºr√ºn i√ßin listeyi true yap
            if (rightInput && leftInput && rightInput.value.trim() === expectedRight && leftInput.value.trim() === expectedLeft) {
                 barkodDogruList[productIndex] = true;
            } else {
                 // Bir tanesi doƒüru girilse bile diƒüeri hen√ºz doƒüru deƒüilse veya bo≈üsa false kalƒ±r
                 barkodDogruList[productIndex] = false;
            }

            // Sonraki inputa ge√ßi≈üi biraz geciktir ve odakla
            setTimeout(() => {
                let nextInput = null;
                if (side === 'right') {
                    // Saƒü tek girildi, aynƒ± √ºr√ºn√ºn sol tekine odaklan
                    nextInput = document.getElementById(`barkodInput-left-${productIndex}`);
                } else if (side === 'left') {
                    // Sol tek girildi, bir sonraki √ºr√ºn√ºn saƒü tekine odaklan
                    nextInput = document.getElementById(`barkodInput-right-${productIndex + 1}`);
                }

                if (nextInput) {
                    nextInput.focus();
                } else {
                    // Eƒüer son input ise, belki onay butonuna odaklanabilir?
                    onaylaBtn.focus();
                }
            }, 200); // 200ms gecikme

            } else if (inputValue.length > 0) { // Sadece inputta deƒüer varsa yanlƒ±≈ü mesajƒ±nƒ± g√∂ster
            matchMessage.classList.remove('alert-success');
            matchMessage.classList.add('alert-danger', 'alert-show');
            matchMessage.textContent = 'Barkod yanlƒ±≈ü!';
            // barkodDogruList durumunu g√ºncelle: Bu input yanlƒ±≈üsa, bu √ºr√ºn kesin false olur
            barkodDogruList[productIndex] = false;


            } else { // Input bo≈üaltƒ±ldƒ±ysa
                // Mesaj gizlendi, arka plan rengi sƒ±fƒ±rlandƒ± (yukarƒ±da yapƒ±ldƒ±)
                // barkodDogruList durumunu bu inputun durumu ve diƒüer tek'in durumuyla g√ºncelle
                const productIndex = parseInt(input.dataset.productIndex);
                const rightInput = document.getElementById(`barkodInput-right-${productIndex}`);
                const leftInput = document.getElementById(`barkodInput-left-${productIndex}`);
                const expectedRight = document.getElementById(`expectedBarcode-right-${productIndex}`).value.trim();
                const expectedLeft = document.getElementById(`expectedBarcode-left-${productIndex}`).value.trim();

                // ƒ∞ki input da dolu VE doƒüru mu?
                if (rightInput && leftInput && rightInput.value.trim() === expectedRight && leftInput.value.trim() === expectedLeft && rightInput.value.trim() !== '' && leftInput.value.trim() !== '') {
                     barkodDogruList[productIndex] = true;
                } else {
                     barkodDogruList[productIndex] = false;
                }
            }

            // T√ºm barkodlar doƒürulanƒ±rsa butonlar a√ßƒ±lƒ±r (ve toggle'a g√∂re otomatik eylem ba≈ülar)
            updateButtonStates();
            });

            // Inputtan √ßƒ±kƒ±nca mesajƒ± gizle (Sadece yanlƒ±≈ü mesajƒ± varsa ve input bo≈üsa)
            input.addEventListener('blur', function() {
            const side = input.dataset.side;
            const productIndex = parseInt(input.dataset.productIndex);
            const expectedBarcode = document.getElementById(`expectedBarcode-${side}-${productIndex}`).value;
            const matchMessage = document.getElementById(`barkodMatchMessage-${side}-${productIndex}`);
            const inputValue = input.value.trim();
            const expectedValue = expectedBarcode.trim();

            // Input bo≈üsa veya doƒüru girilmi≈üse mesajƒ± gizle
            if (inputValue.length === 0 || inputValue === expectedValue) {
             matchMessage.classList.remove('alert-show');
            }
            // Eƒüer input dolu VE yanlƒ±≈üsa mesaj kalƒ±r (input eventinde ayarlanmƒ±≈ütƒ±)
            });

            // Focuslandƒ±ƒüƒ±nda mesajƒ± tekrar g√∂sterme logic'i
            input.addEventListener('focus', function() {
                 const side = input.dataset.side;
                const productIndex = parseInt(input.dataset.productIndex);
                const expectedBarcode = document.getElementById(`expectedBarcode-${side}-${productIndex}`).value;
                const matchMessage = document.getElementById(`barkodMatchMessage-${side}-${productIndex}`);
                const inputValue = input.value.trim();
                const expectedValue = expectedBarcode.trim();

                // Eƒüer input doluysa ve doƒüru veya yanlƒ±≈ü girilmi≈üse mesajƒ± tekrar g√∂ster
                if (inputValue.length > 0) {
                    if (inputValue === expectedValue) {
                        matchMessage.classList.remove('alert-danger');
                        matchMessage.classList.add('alert-success', 'alert-show');
                        matchMessage.textContent = 'Barkod doƒüru!';
                    } else {
                        matchMessage.classList.remove('alert-success');
                        matchMessage.classList.add('alert-danger', 'alert-show');
                        matchMessage.textContent = 'Barkod yanlƒ±≈ü!';
                    }
                }
                // Input bo≈üsa focuslandƒ±ƒüƒ±nda mesaj g√∂r√ºnmez (bu istenen davranƒ±≈ü)
            });

            }); // barkodInputs.forEach biti≈üi


            // ### LOCAL STORAGE: Toggle durumu deƒüi≈ütiƒüinde kaydet ###
            autoShipToggle.addEventListener('change', function() {
            localStorage.setItem('autoShipEnabled', autoShipToggle.checked.toString());
            updateButtonStates(); // Toggle durumu deƒüi≈ütiƒüinde mevcut barkod durumuna g√∂re aksiyonu ayarla
            });
            // ### LOCAL STORAGE: Kaydetme Bitti ###


            // Sayfa y√ºklendiƒüinde buton durumunu ayarla (toggle durumu localStorage'dan y√ºklendiƒüi i√ßin doƒüru olacak)
            // ve ilk inputa odaklanma da DOMContentLoaded i√ßinde yapƒ±ldƒ±.
            updateButtonStates();


            }); // DOMContentLoaded biti≈üi


            // Kopyalama fonksiyonu (mevcuttu)
            function copyToClipboard(elementId, element) {
            const text = document.getElementById(elementId).innerText;
            // Yeni nesil kopyalama API'ƒ± kullan
            if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
            const confirmation = element.nextElementSibling;
            confirmation.classList.add('show');
            setTimeout(() => {
            confirmation.classList.remove('show');
            }, 2000);
            }).catch(err => {
            console.error('Kopyalarken hata olu≈ütu: ', err);
            // Eski y√∂nteme geri d√∂n
            fallbackCopyToClipboard(text, element);
            });
            } else {
            // Eski y√∂nteme geri d√∂n
            fallbackCopyToClipboard(text, element);
            }
            }

            // Eski nesil kopyalama fonksiyonu (fallback)
            function fallbackCopyToClipboard(text, element) {
            const tempInput = document.createElement('textarea');
            tempInput.value = text;
            tempInput.style.position = 'absolute'; // Ekran dƒ±≈üƒ±nda gizle
            tempInput.style.left = '-9999px';
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
            document.execCommand('copy');
            const confirmation = element.nextElementSibling;
            confirmation.classList.add('show');
            setTimeout(() => {
            confirmation.classList.remove('show');
            }, 2000);
            } catch (err) {
            console.error('Eski y√∂ntemle kopyalarken hata olu≈ütu: ', err);
            alert('Kopyalama ba≈üarƒ±sƒ±z oldu, l√ºtfen manuel kopyalayƒ±n.');
            }
            document.body.removeChild(tempInput);
            }


            // Ar≈üiv modalƒ±nƒ± g√∂ster (mevcut)
            function showArchiveModal(order_number) {
            document.getElementById('archiveOrderNumber').value = order_number;
            $('#archiveModal').modal('show');
            }

            // Ar≈üiv modalƒ±ndaki sebep se√ßimi deƒüi≈ütiƒüinde diƒüer sebep alanƒ±nƒ± g√∂ster/gizle (mevcut)
            $('#archiveReason').change(function() {
            if ($(this).val() === 'Diƒüer') {
            $('#otherReasonDiv').show();
            $('#otherReasonText').prop('required', true);
            } else {
            $('#otherReasonDiv').hide();
            $('#otherReasonText').prop('required', false);
            }
            });


            // Ar≈üiv formunu submit et (mevcut)
            $('#archiveForm').submit(function(event) {
            event.preventDefault();
            var order_number = $('#archiveOrderNumber').val();
            var archive_reason = $('#archiveReason').val();
            var other_reason = $('#otherReasonText').val(); // Diƒüer sebep metnini al


            if (!archive_reason) {
            alert('L√ºtfen bir sebep se√ßin.');
            return;
            }

            // Eƒüer sebep "Diƒüer" ise ve a√ßƒ±klama bo≈üsa uyar
            if (archive_reason === 'Diƒüer' && other_reason.trim() === '') {
            alert('L√ºtfen diƒüer sebep a√ßƒ±klamasƒ±nƒ± girin.');
            return;
            }
            // Eƒüer sebep "Diƒüer" deƒüilse ama a√ßƒ±klama alanƒ±nda bir ≈üeyler varsa temizle (gerekirse)
            if (archive_reason !== 'Diƒüer') {
            other_reason = '';
            }


            // Sunucuya g√∂nderilecek veriyi hazƒ±rla
            var postData = {
            order_number: order_number,
            archive_reason: archive_reason,
            other_reason: other_reason // A√ßƒ±klamayƒ± da ekle
            };


            $.post('/archive_order', postData, function(response) { // postData kullanƒ±ldƒ±
            if (response.success) {
            $('#archiveModal').modal('hide');
            $('#archiveSuccessToast').toast('show');
            setTimeout(() => {
            window.location.href = '/'; // Anasayfaya y√∂nlendir
            }, 2000);
            } else {
            alert('Sipari≈ü ar≈üivlenirken hata: ' + response.message);
            }
            }).fail(function() {
            alert('Sipari≈ü ar≈üivlenirken bir aƒü hatasƒ± olu≈ütu.');
            });
            });
        </script>
    </body>
</html>
