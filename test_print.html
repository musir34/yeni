<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Test QR ve Barkod YazdÄ±rma</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            border: 2px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .preview {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .print-preview {
            width: 100mm;
            height: 100mm;
            border: 1px solid #000;
            margin: 20px auto;
            padding: 8mm;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3mm;
            font-family: Arial, sans-serif;
        }
        .raf-kodu {
            font-size: 24pt;
            font-weight: bold;
            text-align: center;
        }
        .gorsel-alani {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2mm;
        }
        .qr-kod {
            width: 120px;
            height: 120px;
        }
        .barkod svg {
            max-width: 80mm;
            height: auto;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª QR Kod ve Barkod YazdÄ±rma Test SayfasÄ±</h1>
    
    <div class="test-container">
        <h2>Test Parametreleri</h2>
        <input type="text" id="testRafKodu" placeholder="Raf Kodu (Ã¶rn: A-01-01)" value="A-01-01" style="padding: 10px; font-size: 16px; width: 300px;">
        <button class="btn" onclick="generatePreview()">Ã–nizleme OluÅŸtur</button>
        <button class="btn" id="printBtn" onclick="yazdirRafEtiketi()" disabled>YazdÄ±r</button>
    </div>

    <div id="statusContainer"></div>

    <div class="test-container">
        <h2>GÃ¶rsel Ã–nizleme</h2>
        <div class="print-preview" id="printPreview">
            <div class="raf-kodu">Raf Kodu</div>
            <div class="gorsel-alani">
                <div>QR kod ve barkod burada gÃ¶rÃ¼necek...</div>
            </div>
        </div>
    </div>

    <script>
        let currentRafKodu = '';

        function showStatus(message, type = 'success') {
            const container = document.getElementById('statusContainer');
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        function generatePreview() {
            const rafKodu = document.getElementById('testRafKodu').value.trim();
            if (!rafKodu) {
                showStatus('LÃ¼tfen bir raf kodu girin!', 'error');
                return;
            }

            currentRafKodu = rafKodu;
            const preview = document.getElementById('printPreview');
            
            // Ã–nceki iÃ§eriÄŸi temizle
            preview.innerHTML = `
                <div class="raf-kodu">${rafKodu}</div>
                <div class="gorsel-alani">
                    <canvas id="previewQR" style="width: 120px; height: 120px;"></canvas>
                    <div class="barkod">
                        <svg id="previewBarcode"></svg>
                    </div>
                </div>
            `;

            try {
                // QR kod oluÅŸtur
                const qrCanvas = document.getElementById('previewQR');
                QRCode.toCanvas(qrCanvas, rafKodu, { width: 120, margin: 2 }, function(error) {
                    if (error) {
                        showStatus('QR kod oluÅŸturulamadÄ±: ' + error.message, 'error');
                        return;
                    }
                    
                    // Barkod oluÅŸtur
                    const barcodeSvg = document.getElementById('previewBarcode');
                    JsBarcode(barcodeSvg, rafKodu, {
                        format: 'CODE128',
                        displayValue: false,
                        width: 2,
                        height: 50,
                        margin: 3
                    });
                    
                    showStatus('âœ… QR kod ve barkod baÅŸarÄ±yla oluÅŸturuldu!');
                    document.getElementById('printBtn').disabled = false;
                });
            } catch (e) {
                showStatus('Hata: ' + e.message, 'error');
            }
        }

        function yazdirRafEtiketi() {
            if (!currentRafKodu) {
                showStatus('Ã–nce bir Ã¶nizleme oluÅŸturun!', 'error');
                return;
            }

            // Ana pencerede QR kod ve barkod oluÅŸtur
            const tempContainer = document.createElement('div');
            tempContainer.style.display = 'none';
            document.body.appendChild(tempContainer);

            const qrCanvas = document.createElement('canvas');
            const barcodeSvg = document.createElement('svg');
            tempContainer.appendChild(qrCanvas);
            tempContainer.appendChild(barcodeSvg);

            try {
                // QR kod oluÅŸtur
                QRCode.toCanvas(qrCanvas, currentRafKodu, { width: 120, margin: 2 }, function(error) {
                    if (error) {
                        showStatus('QR kod oluÅŸturulamadÄ±: ' + error.message, 'error');
                        document.body.removeChild(tempContainer);
                        return;
                    }
                    
                    // Barkod oluÅŸtur
                    JsBarcode(barcodeSvg, currentRafKodu, {
                        format: 'CODE128',
                        displayValue: false,
                        width: 2,
                        height: 50,
                        margin: 3
                    });

                    // YazdÄ±rma penceresini aÃ§
                    setTimeout(() => {
                        const qrDataURL = qrCanvas.toDataURL();
                        const barcodeHTML = barcodeSvg.outerHTML;
                        
                        const printWindow = window.open('', '_blank');
                        printWindow.document.write(`
                            <html>
                                <head>
                                    <title>Raf Etiketi YazdÄ±r - ${currentRafKodu}</title>
                                    <style>
                                        @page { 
                                            size: 100mm 100mm; 
                                            margin: 0; 
                                        }
                                        body { 
                                            width: 100mm;
                                            height: 100mm;
                                            margin: 0;
                                            padding: 8mm;
                                            font-family: Arial, sans-serif;
                                            display: flex;
                                            flex-direction: column; 
                                            align-items: center;    
                                            justify-content: center;
                                            box-sizing: border-box; 
                                            gap: 3mm;
                                        }
                                        .raf-kodu {
                                            font-size: 24pt;
                                            font-weight: bold;
                                            margin: 0;
                                            text-align: center;
                                            flex-shrink: 0;
                                        }
                                        .gorsel-alani {
                                            width: 100%;
                                            display: flex;
                                            flex-direction: column;
                                            align-items: center;
                                            justify-content: center;
                                            gap: 2mm;
                                        }
                                        .qr-kod {
                                            width: 120px;
                                            height: 120px;
                                        }
                                        .barkod {
                                            width: 100%;
                                            height: auto;
                                            max-width: 80mm;
                                        }
                                        @media print {
                                            body { 
                                                -webkit-print-color-adjust: exact;
                                                print-color-adjust: exact;
                                            }
                                        }
                                    </style>
                                </head>
                                <body>
                                    <div class="raf-kodu">${currentRafKodu}</div>
                                    <div class="gorsel-alani">
                                        <img src="${qrDataURL}" class="qr-kod" alt="QR Kod">
                                        <div class="barkod">${barcodeHTML}</div>
                                    </div>
                                </body>
                            </html>
                        `);
                        printWindow.document.close();

                        setTimeout(function() {
                            printWindow.print();
                            printWindow.onafterprint = function() {
                                printWindow.close();
                            }
                        }, 500);
                        
                        // GeÃ§ici container'Ä± temizle
                        document.body.removeChild(tempContainer);
                        showStatus('âœ… YazdÄ±rma penceresi aÃ§Ä±ldÄ±!');
                    }, 100);
                });
            } catch (e) {
                showStatus('Hata: ' + e.message, 'error');
                document.body.removeChild(tempContainer);
            }
        }

        // Sayfa yÃ¼klendiÄŸinde kÃ¼tÃ¼phaneleri kontrol et
        window.addEventListener('load', function() {
            const checkInterval = setInterval(function() {
                if (typeof QRCode !== 'undefined' && typeof JsBarcode !== 'undefined') {
                    showStatus('âœ… QR kod ve barkod kÃ¼tÃ¼phaneleri baÅŸarÄ±yla yÃ¼klendi!');
                    clearInterval(checkInterval);
                    generatePreview(); // Otomatik olarak Ã¶nizleme oluÅŸtur
                }
            }, 100);
        });
    </script>
</body>
</html>